<apex:page docType="html-5.0" id="thePage" title="Price Quote: #{!pq.Price_Quote_Name__c}" standardController="Price_Quote__c" extensions="PP_Price_Quote" sidebar="false"
           action="{!helperMethod}" language="{!userLang}" >
    
    <apex:includeScript value="/soap/ajax/44.0/connection.js"/>
    <style type="text/css" cache="false">

        /* handles hiding/displaying of Account output/input field */ 
        .accountIntCtrls {
        display:none;
        }
        .accountOutCtrls {
        display:block;
        }

        /* handles hiding/displaying of Contact output/input Field */
        .contactIntCtrls {
        display:none;
        }
        .contactOutCtrls {
        display:block;
        }

        /* handles hiding/displaying of Owner output/input field */
        .ownerIntCtrls {
        display:none;
        }
        .ownerOutCtrls {
        display:block;
        }

        /* Used to surpress the 'Submit for Approval' button in the related list (21Oct2015/ESC) */
        input.btn[name="piSubmit"] {
        display: none;
        }

        .dropdown-menu > .disabled{
        cursor: not-allowed;
        }

        /* The real magic ;) */
        .dropdown-menu > .disabled > a{
        pointer-events: none;
        }
        
        /* removing styling to table header
        #sortable th {
        	background-color: #4698CB;
        	color: white;
        }
        
        #sortable th a:link {
        	color: white;
        }
        */
        
        #sortable {
        	border-style: ridge;
        }
        
        #errors-js{
        	margin: auto;
            text-align: center;
            font-size: large;
            background-color: red;
            color: white;
        	border-radius: 30px;
        	padding: 10px 10px 10px 10px;
        	max-width: 700px;
        }
        
        #errors-js:empty{
        	display: none;
        }

        #salesOrgList{
        display: none;
        }

        .bRelatedList .relatedProcessHistory .extraRow td.actionColumn .actionLink, .bRelatedList .relatedProcessHistory .extraRow td, .bRelatedList .relatedProcessHistory .extraRow th{
            color:black;
        }
        .row-striped:nth-of-type(odd){
            background-color: #ffa300;
        }
        /* Lighter */
            .row-striped:nth-of-type(even){
            background-color: #ffa300;
        }

        <!-- **************************************** Pricing Tier Matrix ******************************************************* -->

        table.fs10 td, table.fs10 th{
        font-size: 11px;
        vertical-align: middle !important;
        text-align:center !important;
        padding: 5px !important;
        }

        table.fs10a td, table.fs10a th{
        font-size: 11px;
        vertical-align: middle !important;
        padding: 5px !important;
        }

        .tinyMan{
        width: 20px !important;
        padding: 5px !important;
        }

        <!-- **************************************** END Pricing Tier Matrix ******************************************************* -->
        <!-- Approval CSS -->
        .panel.panel-horizontal {
        display:table;
        width:100%;
        }
        .panel.panel-horizontal > .panel-heading, .panel.panel-horizontal > .panel-body, .panel.panel-horizontal > .panel-footer {
        display:table-cell;
        }
        .panel.panel-horizontal > .panel-heading, .panel.panel-horizontal > .panel-footer {
        width: 20%;
        border:0;
        vertical-align: middle;
        }
        .panel.panel-horizontal > .panel-heading {
        border-right: 1px solid #ddd;
        border-top-right-radius: 0;
        border-bottom-left-radius: 4px;
        }
        .panel.panel-horizontal > .panel-footer {
        border-left: 1px solid #ddd;
        border-top-left-radius: 0;
        border-bottom-right-radius: 4px;
        }
        .panel-default > .panel-heading-custom {
        background: red;
        color: white;
        }
        #wrap {
        padding:1em;
        }

    </style>
    
    <div class="teleflex">
        <apex:include id="menu" pageName="PP_Menu"/>
        <!-- DIV to Render the rest of the page in Bootstrap -->

        <apex:outputPanel title="" id="error">
            <apex:pageMessages ></apex:pageMessages>
        </apex:outputPanel>
        <!-- Customer Service Variables -->
        <apex:variable var="csRemove" value="{!IF(contains($UserRole.Name,'Customer Service'),TRUE,FALSE)}"/>
        <apex:variable var="latamRemove" value="{!IF(contains($UserRole.Name,'Latin America'),TRUE,FALSE)}"/>
        <apex:variable var="showType" value="{!IF(contains($UserRole.Name,'Latin America') || contains($UserRole.Name,'Teleflex Global IT') || pq.BusinessUnit__c = 'Anesthesia' || pq.BusinessUnit__c = 'EMS' || pq.BusinessUnit__c = 'Alternate Care',TRUE,FALSE)}"/>
        <apex:variable var="siRemove" value="{!IF(contains($UserRole.Name,'Surgical Instruments') || userBu == 'Surgical Instruments',TRUE,FALSE)}"/>
        <apex:variable var="userLevel" value="{!IF(contains($UserRole.Name,'Teleflex Global IT') || contains($UserRole.Name,'Commercial Operations') || userApprovalLevel == TRUE,TRUE,FALSE)}"/>
        <apex:variable var="emeaUser" value="{!IF(contains($UserRole.Name,'EMEA') || pq.BusinessUnit__c = 'EMEA',TRUE,FALSE)}"/>
        <!-- END: Customer Service Variables -->

        <div class="teleflex">
            <div class="contain-fluid">
                <div class="row">
                    <!-- Column One -->
                    <apex:outputPanel title="" id="customerPanel">
                        <apex:form id="customerform" html-ng-non-bindable="true"> <!-- Start of customerform -->
                            <apex:actionFunction name="updateAccountValue" action="{!doUpdateAccountValue}" reRender="customerform" oncomplete="initialize();"/>
                            <div class="col-md-4"> <!-- Start of Customer Detail Box -->
                                <div class="panel panel-primary">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">{!$Label.EMEA_Customer_Detail}</h3>
                                    </div>
                                    <!-- <apex:pageMessages id="updatemessage"></apex:pageMessages> -->
                                    <div class="panel-body">
                                        <table class="table table-hover fs10a">
                                            <tr>
                                                <td width="150" class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Account_Name__c.label}" />:</td>
                                                <apex:outputText rendered="{!pq.Account_Name__r.SAP_Sold_To__c != NULL}">
                                                    <apex:outputText rendered="{!!emeaUser}">
                                                        <td class="accountOutCtrls"><a href="/apex/PP_Customer_Details?cid={!pq.Account_Name__r.SAP_Sold_To__c}"><b>{!pq.Account_Name__r.Name}</b></a></td>
                                                    </apex:outputText>
                                                    <apex:outputText rendered="{!emeaUser}">
                                                        <td class="accountOutCtrls"><a href="/apex/PP_Customer_Details?cid={!pq.Account_Name__r.SAP_Sold_To__c}"><b>{!pq.Account_Name__r.Name}<br />{!pq.Account_Name__r.Account_Name_2__c}</b></a></td>
                                                    </apex:outputText>
                                                </apex:outputText>
                                                <apex:outputText rendered="{!pq.Account_Name__r.SAP_Sold_To__c == NULL}">
                                                    <td class="accountOutCtrls"><a href="/{!pq.Account_Name__r.Id}"><b>{!pq.Account_Name__r.Name}</b></a></td>
                                                </apex:outputText>
                                                <td class="accountIntCtrls"><apex:inputField value="{!pq.Account_Name__c}"/></td>
                                            </tr>
                                             <tr><td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Address__c.label}" />:</td><td>{!pq.Account_Name__r.BillingStreet}</td></tr><tr>
                                            <td class="text-right">&nbsp;</td><td>{!pq.Account_Name__r.BillingCity},&nbsp;{!pq.Account_Name__r.BillingState}&nbsp;{!pq.Account_Name__r.BillingPostalCode}</td>
                                            </tr>
                                            <tr><td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Account_Billing_Country__c.label}" />:</td><td>{!pq.Account_Name__r.BillingCountry}</td></tr>
                                            <tr><td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Account_SAP_Code__c.label}" />:</td><td>{!pq.Account_Name__r.SAP_Sold_To__c}</td></tr>
                                            <tr><td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Sold_To__c.label}" />:</td><td>{!pq.Sold_To__c}</td></tr>
                                        </table>
                                        <center>
                                            <!-- <a class="btn btn-primary btn-sm accountOutCtrls" onclick="changeAccount('{!$Component.update}')" >Change customer</a> -->
                                            <apex:variable value="" var="d" rendered="{!NOT(pq.InApproval__c) && !reviseButton}">
                                                <a class="btn btn-primary btn-sm" id="a-update" onclick="changeAccount()" >{!$Label.EMEA_Change_Customer}</a>
                                            </apex:variable>

                                            <apex:variable value="" var="d" rendered="{!pq.InApproval__c || reviseButton}">
                                                <a class="btn btn-primary btn-sm disabled" id="a-update" onclick="changeAccount()" >{!$Label.EMEA_Change_Customer}</a>
                                            </apex:variable>

                                        </center>
                                        &nbsp;
                                        <table class="table table-hover fs10a">
                                            <tr><td width="150" class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Contact_Name__c.label}" />:</td>
                                                <td class="contactOutCtrls" >
                                                    <a href="/{!pq.Contact_Name__r.id}"><b>{!pq.Contact_Name__r.name}</b></a>
                                                </td>
                                                <td class="contactIntCtrls">
                                                    <apex:inputField value="{!pq.Contact_Name__c}"/>
                                                </td>
                                            </tr>
                                            <tr><td class="text-right"><apex:outputLabel value="{!$ObjectType.Contact.fields.Phone.label}" />:</td><td>{!pq.Contact_Name__r.phone}</td></tr>
                                            <tr><td class="text-right"><apex:outputLabel value="{!$ObjectType.Contact.fields.Email.label}" />:</td><td>{!pq.Contact_Name__r.email}</td></tr>
                                        </table>
                                        <center>
                                            <a onclick="updateAccountValue();" class="btn btn-primary btn-sm"  id="update" style="display:none">{!$Label.EMEA_Update}</a>
                                            &nbsp;
                                            <!-- Quote In Progress or Rejected -->
                                            <a href="/{!pq.Contact_Name__r.id}/e?retURL=%2F{!pq.id}" class="btn btn-primary btn-sm">{!$Label.EMEA_Edit_Contact}</a>
                                            <!-- Quote In Progress or Rejected -->

                                        </center> <!-- Change Contact -->
                                    </div>
                                </div>
                            </div> <!-- End of Customer Detail Box -->
                        </apex:form> <!-- End of customerform -->
                    </apex:outputPanel>
                    <!-- End Column One -->

                    <!-- Column Two -->
                    <apex:form id="priceform" html-ng-non-bindable="true"> <!--Start of priceform -->

                        <apex:actionFunction name="priceQuotePanel" reRender="quotePanel,priceform,customerform" oncomplete="initialize();"/>
                        <apex:outputPanel id="quotePanelContainer">
                            <apex:outputPanel id="quotePanel">
                                <div class="col-md-4"> <!-- Start of Price Quote Box -->
                                    <div class="panel panel-primary">
                                        <div class="panel-heading">
                                            <apex:outputText rendered="{!isLocked}">
                                                <span data-toggle="tooltip" data-placement="top" title="Record Locked!" class="glyphicon glyphicon-lock"></span>
                                            </apex:outputText>
                                            <apex:outputtext rendered="{!!emeaUser}">
                                                <apex:outputText rendered="{!!contains($UserRole.Name,'Capital')}"><h3 class="panel-title">{!$Label.EMEA_Price_Quote}: {!pq.CurrencyIsoCode} <apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatTotalPrices[pq.Id]}</h3></apex:outputText>
                                                <apex:outputText rendered="{!contains($UserRole.Name,'Capital')}"><h3 class="panel-title">{!$Label.EMEA_Price_Quote}: {!pq.CurrencyIsoCode} <apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!round(pq2.Discounted_Total__c,2)}</h3></apex:outputText>
                                            </apex:outputtext>
                                            <apex:outputText rendered="{!emeaUser}">
                                                <h3 class="panel-title">{!$Label.EMEA_Grand_Total}({!pq.CurrencyIsoCode}):&nbsp;{!calculateVatTotal}</h3>
                                            </apex:outputText>
                                        </div>
                                        <div class="panel-body">

                                            <table class="table table-hover fs10a">
                                                <apex:outputText rendered="{!(pq.InApproval__c || pq.Status__c == 'Approved') && $UserRole.Name = 'Teleflex Global IT'}">
                                                    <tr><td width="150" class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Status__c.label}" />:</td><td><a href="/apex/PP_ApprovalLayout?pqId={!pq.id}&gs=off">{!pq.Status__c}</a></td></tr>
                                                    <apex:outputText rendered="{!approvalInfo != NULL}">
                                                        <tr><td width="150" class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Current_Approver__c.label}" />:</td>
                                                            <td>
                                                                <apex:repeat value="{!approvalInfo}" var="a">
                                                                    <li style="margin-left: 0px; list-style:none;">
                                                                        {!a.Actor.Name}
                                                                    </li>
                                                                </apex:repeat>
                                                            </td>
                                                        </tr>
                                                        <!-- <tr><td>Current Approver(s):</td><td>{!pq.Current_Approver__c}</td></tr> -->
                                                    </apex:outputText>
                                                </apex:outputText>
                                                <apex:outputText rendered="{!((NOT(pq.InApproval__c) || pq.Status__c != 'Approved') && $UserRole.Name != 'Teleflex Global IT')
                                                                           || NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}">
                                                    <tr><td width="150" class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Status__c.label}" />:</td><td>{!pq.Status__c}</td></tr>
                                                    <apex:outputText rendered="{!approvalInfo != NULL}">
                                                        <tr><td width="150" class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Current_Approver__c.label}" />:</td>
                                                            <td>
                                                                <apex:repeat value="{!approvalInfo}" var="a">
                                                                    <li style="margin-left: 0px; list-style:none;">
                                                                        {!a.Actor.Name}
                                                                    </li>
                                                                </apex:repeat>
                                                            </td>
                                                        </tr>
                                                        <!-- <tr><td>Current Approver(s):</td><td>{!pq.Current_Approver__c}</td></tr> -->
                                                    </apex:outputText>
                                                </apex:outputText>
                                                <!-- <tr><td width="150" class="text-right">Status:</td><td>{!pq.Status__c}</td></tr> -->
                                                <tr><td width="150" class="text-right text-nowrap"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Name.label}" />:</td><td>#{!pq.name}</td></tr>
                                                <!-- <tr><td width="150" class="text-right">Currency:</td><td>{!pq.CurrencyIsoCode}</td></tr> -->
                                                <tr>
                                                    <td class="text-right text-nowrap"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Expiration_Date__c.label}" />:</td>
                                                    <td><apex:outputText rendered="{!emeaUser}"><apex:outputText value="{0,date,dd/MM/yyyy}">
                                                            <apex:param value="{!pq.Expiration_Date__c}"/>
                                                        </apex:outputText>
                                                        </apex:outputText>
                                                    <apex:outputField rendered="{!!emeaUser}" value="{!pq.Expiration_Date__c}"/>
                                                    </td>
                                                </tr>
                                                <tr><td class="text-right text-nowrap"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Quote_Description__c.label}" />:</td><td>{!pq.Quote_Description__c}</td></tr>
                                                <tr><td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Commit_Date__c.label}" />:</td><td><apex:outputField value="{!pq.Commit_Date__c}"/></td></tr>
                                                <tr><td class="text-right text-nowrap"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Customer_comments__c.label}" />:</td><td><apex:outputField value="{!pq.Customer_comments__c}"/></td></tr>
                                                <tr><td class="text-right text-nowrap"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Internal_Comments_Only__c.label}" />:</td><td><apex:outputField value="{!pq.Internal_Comments_Only__c}"/></td></tr>
                                                <apex:variable value="{!if(IsBlank(pq.Opportunity__r.Name),FALSE,TRUE)}" var="OppExists"/>

                                                <apex:outputText rendered="{!!OppExists && !csRemove}">
                                                    <apex:outputText rendered="{!!emeaUser}">
                                                    <tr>
                                                        <td class="text-right text-nowrap"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Opportunity__c.label}" />:</td>
                                                        <td>
                                                            <apex:commandLink action="{!editpq}" value="Add Existing" />&nbsp;/&nbsp;
                                                            <apex:commandLink action="{!newCreateOpp}" value="Create New" />&nbsp;
                                                        </td>
                                                    </tr>
                                                    </apex:outputText>
                                                </apex:outputText>

                                                <apex:outputText rendered="{!OppExists && !csRemove}">
                                                    <apex:outputText rendered="{!!emeaUser}">
                                                    <tr><td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Opportunity__c.label}" />:</td>
                                                        <td>
                                                            <apex:outputLink value="/{!pq.Opportunity__c}" id="oppy">{!pq.Opportunity__r.Name}</apex:outputLink><br/>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="text-right">Opportunity Sync:</td>
                                                        <td>
                                                            <apex:outputText rendered="{!pq.IsActive__c && !pq.Opportunity_Closed__c}">
                                                                Active Quote
                                                            </apex:outputText>
                                                            <apex:outputText rendered="{!!pq.IsActive__c && !pq.Opportunity_Closed__c}">
                                                                Not Active Quote :&nbsp;<apex:commandLink action="{!makeActivePQ}">Make Quote Active!</apex:commandLink>
                                                            </apex:outputText>
                                                            <apex:outputText rendered="{!!pq.IsActive__c && pq.Opportunity_Closed__c}">
                                                                Not Active Quote and Opportunity Closed
                                                            </apex:outputText>
                                                            <apex:outputText rendered="{!pq.IsActive__c && pq.Opportunity_Closed__c}">
                                                                Not Sync'ing - Opportunity Closed
                                                            </apex:outputText>

                                                        </td>
                                                    </tr>
                                                    </apex:outputText>
                                                </apex:outputText>


                                                <apex:outputText rendered="{!!emeaUser}">
                                                <apex:outputText rendered="{!(!pq.InApproval__c && pq.PRF__c == NULL && pq.Status__c != 'Approved')  && !csRemove}">
                                                    <tr>
                                                        <apex:outputText rendered="{!!latamRemove}">
                                                            <td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.One_Time_Purchase__c.label}" />?:</td>
                                                        </apex:outputText>
                                                        <apex:outputText rendered="{!latamRemove && emeaUser}">
                                                            <td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.One_Time_Purchase__c.label}" />?/:<br />Special Sales</td>
                                                        </apex:outputText>
                                                        <td>
                                                            <apex:inputField rendered="{!!latamRemove && !emeaUser}" value="{!pq.One_Time_Purchase__c}">
                                                                <apex:actionSupport event="onclick" reRender="quotePanel,error" action="{!saveOneTime}"/>
                                                            </apex:inputField>
                                                            <apex:outputField rendered="{!latamRemove && emeaUser}" value="{!pq.One_Time_Purchase__c}" />
                                                        </td>
                                                    </tr>
                                                </apex:outputText>
                                                </apex:outputText>
                                                <!-- Added for LATAM -->
                                                <apex:outputText rendered="{!showType}">
                                                    <tr>
                                                        <td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Type__c.label}" />:</td>
                                                        <td>
                                                            <apex:outputField id="typeId" value="{!pq.Type__c}" />
                                                        </td>
                                                    </tr>
                                                </apex:outputText>
                                                <apex:outputText rendered="{!!emeaUser}">
                                                <apex:outputText rendered="{!!csRemove && !contains(pq.Status__c,'In Progress')}">
                                                    <tr>
                                                        <td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.One_Time_Purchase__c.label}" />?:</td>
                                                        <td>
                                                            <apex:outputField value="{!pq.One_Time_Purchase__c}"/>
                                                        </td>
                                                    </tr>
                                                </apex:outputText>
                                                </apex:outputText>
                                                <apex:outputText rendered="{!contains($UserRole.Name,'EMS') || contains($UserRole.Name,'Anesthesia Inside Sales') || contains($UserRole.Name,'Teleflex Global IT')}">
                                                    <tr>
                                                        <td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Shipping__c.label}" />:</td>
                                                        <td><apex:outputField value="{!pq.Shipping__c}"/></td>
                                                    </tr>
                                                    <tr>
                                                        <td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Tax__c.label}" />:</td>
                                                        <td><apex:outputField value="{!pq.Tax__c}"/></td>
                                                    </tr>
                                                </apex:outputText>
                                                <apex:outputText rendered="{!contains($UserRole.Name,'Capital') || contains($UserRole.Name,'Teleflex Global IT')}">
                                                    <tr>
                                                        <td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Discount__c.label}" />:</td>
                                                        <td><apex:outputField value="{!pq.Discount__c}"/></td>
                                                    </tr>
                                                    <tr>
                                                        <td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Discount_Type__c.label}" />:</td>
                                                        <td><apex:outputField value="{!pq.Discount_Type__c}"/></td>
                                                    </tr>
                                                </apex:outputText>
                                                <tr>
                                                    <td colspan="2" class="text-nowrap" style="text-align:center; vertical-align:middle;">
                                                      
                                                        <apex:variable var="disabled" value="{!if(NOT($UserRole.Name = 'Teleflex Global IT') && NOT($UserRole.Name = 'Commercial Operations') && NOT($User.Alias = 'dkarl'), 'disabled','')}"/>
                                                        <apex:variable var="canupdate" value="{!if(pq.Status__c = 'In Progress' || pq.Status__c = 'Approved' || pq.Status__c = 'Rejected'|| pq.Status__c = 'Cancelled',TRUE,FALSE)}"/>
                                                        <apex:variable var="analysis" value="{!if(pq.Status__c = 'In Progress' || pq.Status__c = 'Rejected',TRUE,FALSE)}"/>
                                                        <apex:variable var="mstatus" value="{!if(pq2.Material_Status_Check__c = 1,'disabled','')}" />
                                                        <!-- Edit Quote Button -->
                                                        <apex:commandLink action="{!editpq}" rendered="{!canupdate}" styleClass="btn btn-primary btn-sm">{!$Label.EMEA_Edit}&nbsp;&nbsp;<span class="glyphicon glyphicon-floppy-disk"></span></apex:commandLink>
                                                        <apex:commandLink rendered="{!!canupdate}" styleClass="btn btn-primary btn-sm disabled">{!$Label.EMEA_Edit}&nbsp;&nbsp;<span class="glyphicon glyphicon-floppy-disk"></span></apex:commandLink>
                                                        
                                                            <div class="btn-group">
                                                                <a class="btn btn-primary btn-sm">{!$Label.EMEA_Action_Menu}</a>
                                                                <a href="#" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown" aria-expanded="false"><span class="caret"></span></a>
                                                                <ul class="dropdown-menu">
                                                                    <li style="margin-left: 0px;">
                                                                        <apex:variable var="canClone" value="{!if((pq.Account_Name__r.ERP_Active__c || pq.Account_Name__r.SAP_Sold_To__c = '') && pq.Sales_Org_Key__c != 'US103020' && pq.Sales_Org_Key__c != 'US103010',true,false)}" />
                                                                        <apex:outputText rendered="{!canClone}">
                                                                            <apex:commandLink action="{!doCloning}" rendered="{!reviseButton && canupdate}" status="actStatusId" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,customerform,customerPanel">
                                                                                Clone w/ Current Account
                                                                            </apex:commandLink>
                                                                        </apex:outputText>
                                                                        <apex:outputText rendered="{!canClone}">
                                                                        <apex:commandLink action="/apex/PP_SelectAccount?pqId={!pq.Id}&gs=off" rendered="{!reviseButton && canupdate}" status="actStatusId" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,customerform,customerPanel">
                                                                            Clone w/ New Account
                                                                        </apex:commandLink>
                                                                        </apex:outputText>
                                                                        <!-- Customer Service -->
                                                                        <apex:outputText rendered="{!!csRemove}">
                                                                            <apex:outputText rendered="{!IF($UserRole.Name = 'Teleflex Global IT' || !needsApproval,true, false )}">
                                                                                <apex:outputText rendered="{!!emeaUser}">
                                                                                    <apex:commandLink action="{!printpq}">{!$Label.EMEA_Print_email}&nbsp;&nbsp;<span class="glyphicon glyphicon-print"></span></apex:commandLink>
                                                                                </apex:outputText>
                                                                                <apex:outputText rendered="{!emeaUser && pq.Status__c = 'Approved'}">
                                                                                    <apex:commandLink action="{!printpq}">{!$Label.EMEA_Print_email}&nbsp;&nbsp;<span class="glyphicon glyphicon-print"></span></apex:commandLink>
                                                                                </apex:outputText>
                                                                            </apex:outputText>
                                                                        </apex:outputText>
                                                                        <apex:outputText rendered="{!NOT(pq.InApproval__c) && NOT(pq.Status__c = 'Approved')}">
                                                                            <apex:commandLink action="{!cancel}" value="{!$Label.EMEA_CancelQuote}">&nbsp;&nbsp;<span class="glyphicon glyphicon-ban-circle"/></apex:commandLink>
                                                                        </apex:outputText>
                                                                        <apex:outputText rendered="{!$UserRole.Name = 'Teleflex Global IT'}">
                                                                            <apex:outputLink value="{!URLFOR($Action.Price_Quote__c.Delete,pq.Id)}">{!$Label.EMEA_Delete}&nbsp;&nbsp;<span class="glyphicon glyphicon-remove-circle"/></apex:outputLink>
                                                                        </apex:outputText>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        
                                                        <!-- Customer Service -->
                                                        <apex:variable var="expiredPq" value="{!IF(pq.Expiration_Date__c <= TODAY(),'disabled','')}"/>
                                                        <apex:outputText rendered="{!!emeaUser}">
                                                        <apex:commandLink rendered="{!pq.Status__c = 'Approved' && !csRemove}" action="{!createPRF}" styleClass="btn btn-primary btn-sm {!expiredPq}">{!$Label.EMEA_Create_PRF}</apex:commandLink>
                                                        </apex:outputText>
                                                        <!-- Commit Quote/Submit for Approval/Create PRF Buttons -->
                                                        <apex:outputText rendered="{!NOT(pq.InApproval__c)  && !csRemove}">
                                                            <apex:outputText rendered="{!subButton}">
                                                                <apex:commandLink styleClass="btn btn-danger btn-sm {!mstatus}" action="{!URLFOR($Action.Price_Quote__c.Submit, pq.Id)}" value="{!$Label.EMEA_Submit_for_Approval}" rendered="{!pq.Status__c != 'Approved'}" id="demo" />
                                                            </apex:outputText>
                                                            <apex:outputText rendered="{!comButton}">
                                                                <apex:commandLink styleClass="btn btn-primary btn-sm {!mstatus}" action="{!URLFOR($Action.Price_Quote__c.Submit, pq.Id)}" value="{!$Label.EMEA_Commit_Quote}" rendered="{!pq.Status__c != 'Approved'}" id="demo1"/>
                                                            </apex:outputText>
                                                            <apex:outputText rendered="{!!emeaUser}">
                                                                <apex:outputText rendered="{!prfButton}">
                                                                    <apex:commandLink styleClass="btn btn-danger btn-sm {!mstatus}" action="{!createPRF}" value="{!$Label.EMEA_SubmitPRF}" rendered="{!pq.Status__c != 'Approved'}" id="demo2" />
                                                                </apex:outputText>
                                                            </apex:outputText>
                                                        </apex:outputText>
                                                        <!-- Quote Locked Button -->
                                                        <apex:commandLink rendered="{!!canupdate}" styleClass="btn btn-primary btn-sm">{!$Label.EMEA_Quote_Locked}&nbsp;&nbsp;<span class="glyphicon glyphicon-lock"></span></apex:commandLink>

                                                        <!-- End Top Middle Buttons -->
                                                    </td></tr>
                                                <apex:outputText rendered="{!!analysis && !csRemove}">
                                                    <tr>
                                                        <apex:outputText rendered="{!userLevel}">
                                                        <td colspan="2" class="text-nowrap" style="text-align:center; vertical-align:middle;">
                                                            <a href="/apex/PP_ApprovalLayout?pqId={!pq.id}&gs=off" Class="btn btn-danger btn-sm">{!$Label.EMEA_Price_Quote_Approval}</a>
                                                        </td>
                                                        </apex:outputText>
                                                    </tr>
                                                </apex:outputText>
                                            </table>
                                        </div>
                                    </div>
                                </div> <!-- End of Price Quote Box -->
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </apex:form> <!-- End of priceform -->
                    <!-- End Column Two -->
                    <!-- Column Three -->
                    <apex:form id="salesform" html-ng-non-bindable="true">
                      <apex:actionFunction name="updateOwnerValue" action="{!doUpdateOwnerValue}" reRender="salesform" oncomplete="initialize();"/>
                        <apex:actionFunction name="setBuValue" action="{!setBu}" reRender="salesPanel, salesform" oncomplete="initialize();">
                            <apex:param name="buValue" value="{!buValue}" assignTo="{!buValue}"/>
                        </apex:actionFunction>
                        <apex:outputPanel title="" id="salesPanel">
                            <div class="col-md-4"> <!-- Start of Contact Info Box -->
                                <div class="panel panel-primary">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">{!$Label.EMEA_Contact_Info}</h3>
                                    </div>
                                    <div class="panel-body">
                                        <table class="table table-hover fs10a">
                                            <tr>
                                              <td width="150" class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Owner_Full_Name__c.label}" />:</td>
                                              <!-- <td><a href="/{!pq.Owner_ID__c}"><b>{!pq.Owner_Full_Name__c}</b></a></td> -->
                                              <td class="ownerOutCtrls"><a href="/{!pq.OwnerId}"><b>{!pq.Owner.Name}</b></a></td>
                                              <td class="ownerIntCtrls"><apex:inputField value="{!pq.OwnerId}"/></td>
                                            </tr>
                                            <tr>
                                                <td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Owner_Business_Unit__c.label}" />:&nbsp;</td>
                                                <apex:outputText rendered="{!!csRemove}" >
                                                    <td>
                                                        <apex:outputText rendered="{!pq.Status__c = 'In Progress' || pq.Status__c = 'Rejected'}">
                                                            <apex:outputText rendered="{!!emeaUser}">
                                                                <apex:selectList id="businessUnits" value="{!pq.BusinessUnit__c}" size="1" onchange="selectBu(this.value);">
                                                                    <apex:selectOptions value="{!pickListValuesIntoList}"/>
                                                                </apex:selectList>
                                                            </apex:outputText>
                                                            <apex:outputText rendered="{!emeaUser}">
                                                                {!pq.BusinessUnit__c}
                                                            </apex:outputText>
                                                        </apex:outputText>
                                                        <apex:outputText rendered="{!pq.Status__c != 'In Progress' && pq.Status__c != 'Rejected'}">
                                                            {!pq.BusinessUnit__c}
                                                        </apex:outputText>
                                                    </td>
                                                </apex:outputText>
                                                <apex:outputText rendered="{!csRemove}" >
                                                    <td>{!pq.Owner_Business_Unit__c}</td>
                                                </apex:outputText>
                                            </tr>
                                            <tr><td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Owner_Cell__c.label}" />:</td><td><apex:outputField value="{!pq.Owner_Cell__c}"/></td></tr>
                                            <tr><td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Owner_Phone__c.label}" />:</td><td>{!pq.Owner_Phone__c}</td></tr>
                                            <tr><td class="text-right"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Owner_Email__c.label}" />:</td><td>{!pq.Owner_Email__c}</td></tr>
                                            <tr><td class="text-right text-nowrap"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.Created_Date_Time__c.label}" />:</td><td><apex:outputField value="{!pq.CreatedById}"/>,&nbsp;<apex:outputField value="{!pq.CreatedDate}"/></td></tr>
                                            <tr><td class="text-right text-nowrap"><apex:outputLabel value="{!$ObjectType.Price_Quote__c.fields.LastModifiedById.label}" />:</td><td><apex:outputField value="{!pq.LastModifiedById}"/>,&nbsp;<apex:outputField value="{!pq.LastModifiedDate}"/></td></tr>
                                            <apex:outputText rendered="{!$UserRole.Name = 'Teleflex Global IT' || $UserRole.Name = 'Commercial Operations' }">
                                                <tr><td class="text-right">Debug:</td><td>
                                                    Sales Org Key: {!pq.Sales_Org_Key__c}<br/>
                                                    <a href="/{!pq.Owner_ID__c}?noredirect=1&isUserEntityOverride=1">{!pq.Owner_Approval_Role__c}({!pq.Workflow_Owner_Approval_Level__c})</a>
                                                    <apex:outputText rendered="{!!emeaUser}">/ Required Level: {!pq2.Approval_Level__c}  <br/></apex:outputText>
                                                    <apex:outputText rendered="{!emeaUser}">/ Required Level: {!pq2.EMEA_Approval_Level__c}  <br/></apex:outputText>
                                                    <a href="/apex/PP_ApprovalLayout?pqId={!pq.id}&gs=off">Super Secret</a><br/>
                                                    Class Key: {!pq.Product_Class_Count__c}<br/>
                                                    <apex:outputText rendered="{!If(soldToAcct = '', true, false)}">
                                                      Acct Type: {!pq.Account_Name__r.Price_List_Type__c} / Acct #: {!pq.Account_Name__r.SAP_Sold_To__c}<br/>
                                                    </apex:outputText>
                                                    <apex:outputText rendered="{!If(soldToAcct != '', true, false)}">
                                                      Sold To Acct Type: {!soldToAcctType} / Sold To Acct #: {!soldToAcct}<br/>
                                                    </apex:outputText>
                                                    Refresh All Lines:&nbsp;
                                                    <apex:commandLink action="{!bulkrefresh}" html-data-toggle="tooltip" html-data-placement="top" title="Refresh Pricing All Lines" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,customerform,customerPanel" StyleClass="glyphicon glyphicon-repeat" status="actStatusId" oncomplete="initialize();">
                                                        <apex:param name="pqid" value="{!pq.Id}"/>
                                                    </apex:commandLink>
                                                    </td>
                                                </tr>

                                            </apex:outputText>


                                        </table>
                                        <center>
                                            <!-- Quote In Progress or Rejected -->
                                            <apex:variable value="" var="d" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}">
                                                <apex:commandLink action="/{!pq.Owner_ID__c}/e?retURL=%2F{!pq.id}" styleClass="btn btn-primary btn-sm">{!$Label.EMEA_Edit_Owner}&nbsp;&nbsp;</apex:commandLink>
                                                <!-- <a href="/{!pq.Owner_ID__c}/e?retURL=%2F{!pq.id}" class="btn btn-primary btn-sm">Edit Owner</a>&nbsp; -->
                                                <!-- <apex:commandLink action="/{!pq.id}/a?retURL=%2F{!pq.id}" styleClass="btn btn-primary btn-sm">Change Owner&nbsp;&nbsp;</apex:commandLink> -->
                                                <apex:variable value="" var="d" rendered="{!NOT(pq.InApproval__c)}">
                                                    <a class="btn btn-primary btn-sm" id="a-ownerUpdate" onclick="changeOwner()" >{!$Label.EMEA_Change_Owner}</a>
                                                </apex:variable>
                                                <apex:variable value="" var="d" rendered="{!pq.InApproval__c}">
                                                    <a class="btn btn-primary btn-sm disabled" id="a-ownerUpdate" onclick="changeOwner()" >{!$Label.EMEA_Change_Owner}</a>
                                                </apex:variable>
                                                <a onclick="updateOwnerValue();" class="btn btn-primary btn-sm"  id="updateOwner" style="display:none">Update</a>
                                                <!-- <apex:commandLink action="/{!pq.id}/e?retURL=%2F{!pq.id}" styleClass="btn btn-primary btn-sm">Change Owner&nbsp;&nbsp;</apex:commandLink> -->
                                                <!-- <a href="/{!pq.id}/a?retURL=%2F{!pq.id}" class="btn btn-primary btn-sm">Change Owner</a>&nbsp; -->
                                                <apex:commandLink action="/_ui/core/email/author/EmailAuthor?p3_lkid={!pq.id}&retURL=%2F{!pq.id}&p2={!pq.Owner_Full_Name__c}&p24={!pq.Owner_Email__c}&p6=" styleClass="btn btn-primary btn-sm">{!$Label.EMEA_Email_Owner}&nbsp;&nbsp;</apex:commandLink>
                                                <!-- <a href="/_ui/core/email/author/EmailAuthor?p3_lkid={!pq.id}&retURL=%2F{!pq.id}&p2={!pq.Owner_Full_Name__c}&p24={!pq.Owner_Email__c}&p6=" class="btn btn-primary btn-sm">Email Owner</a> -->
                                            </apex:variable>
                                            <!-- Quote In Progress or Rejected -->

                                            <!-- Quote In Approval Process -->
                                            <apex:variable value="" var="d" rendered="{!pq.InApproval__c || pq.Status__c = 'Approved'}">
                                                <a href="/{!pq.Owner_ID__c}/e?retURL=%2F{!pq.id}" class="btn btn-primary btn-sm disabled">{!$Label.EMEA_Edit_Owner}</a>&nbsp;
                                                <a href="/{!pq.id}/a?retURL=%2F{!pq.id}" class="btn btn-primary btn-sm disabled">{!$Label.EMEA_Change_Owner}</a>&nbsp;
                                                <a href="/_ui/core/email/author/EmailAuthor?p3_lkid={!pq.id}&retURL=%2F{!pq.id}&p2={!pq.Owner_Full_Name__c}&p24={!pq.Owner_Email__c}&p6=" class="btn btn-primary btn-sm disabled">{!$Label.EMEA_Email_Owner}</a>
                                            </apex:variable>
                                            <!-- Quote In Approval Process -->
                                        </center>
                                        &nbsp;
                                    </div>
                                </div>
                            </div> <!-- End of Contact Info Box -->
                        </apex:outputPanel>
                    </apex:form><!-- End Salesform -->
                    <!-- End Column Three -->
                </div>
            </div>
        </div> <!-- End of 2nd Div Teleflex -->


        <!-- Line Items -->
        <apex:form id="itemsform" html-ng-non-bindable="true">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h6 class="panel-title"><img src="/img/icon/cash24.png" alt="{!$Label.EMEA_LineItems}"/>&nbsp;&nbsp;{!$Label.EMEA_LineItems}</h6>
                </div>
            </div>
            <div class="panel-body">
                <apex:outputPanel id="buttonPannelId">
                    <div>
                        <apex:variable value="{!pq.Quote_Template__c}" var="printURL"/>
                        <apex:variable var="canPrint" value="{!if($UserRole.Name = 'Teleflex Global IT' ||
                                                             $UserRole.Name = 'Commercial Operations' ||
                                                             $User.Alias = 'dkarl' ||
                                                             pq.Status__c = 'Approved' ||
                                                             (!needsApproval && !pq.InApproval__c),'','disabled')}"/>

                        <apex:variable var="emeaCanPrint" value="{!if(pq.BusinessUnit__c = 'EMEA' &&
                                                                pq.Status__c = 'Approved','','disabled')}"/>
                        <!-- Start Quote In Progress or Rejected -->
                        <apex:outputText rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}">
                            <apex:outputlink value="/apex/PP_ProductSearch?pqId={!pq.Id}" styleClass="btn btn-primary btn-sm">
                                {!$Label.EMEA_Material_Search}&nbsp;&nbsp;<span class="glyphicon glyphicon-search"></span>
                            </apex:outputlink>&nbsp;&nbsp;
                            <apex:outputlink value="/apex/PP_CompProductSearch?pqId={!pq.Id}" styleClass="btn btn-primary btn-sm" rendered="{!!emeaUser}">
                                {!$Label.EMEA_Cross_Reference}&nbsp;&nbsp;<span class="glyphicon glyphicon-search"></span>
                            </apex:outputlink>&nbsp;&nbsp;
                        </apex:outputText>
                        <!-- End Quote In Progress or Rejected -->

                        <!-- Start Quote In Approval Process -->
                        <apex:outputText rendered="{!pq.InApproval__c || pq.Status__c = 'Approved'}">
                            <apex:outputlink value="/apex/PP_ProductSearch?pqId={!pq.Id}" styleClass="btn btn-primary btn-sm disabled">
                                {!$Label.EMEA_Material_Search}&nbsp;&nbsp;<span class="glyphicon glyphicon-search"></span>
                            </apex:outputlink>&nbsp;&nbsp;
                            <apex:outputlink value="/apex/PP_CompProductSearch?pqId={!pq.Id}" styleClass="btn btn-primary btn-sm disabled" rendered="{!!emeaUser}">
                                {!$Label.EMEA_Cross_Reference}&nbsp;&nbsp;<span class="glyphicon glyphicon-search"></span>
                            </apex:outputlink>&nbsp;&nbsp;
                        </apex:outputText>
                        <!-- End Quote In Approval Process -->

                        <!-- Start Customer Service -->

                        <apex:outputText rendered="{!csRemove}">
                            <a href="/apex/PP_Print_Center?id={!pq.Id}" class="btn btn-primary btn-sm {!canPrint}">Preview Price Quote&nbsp;&nbsp;<span class="glyphicon glyphicon-print"></span></a>
                        </apex:outputText>

                        <!-- Adding logic to remove button for EMEA -->
                        <apex:outputText rendered="{!!csRemove && NOT(emeaUser)}">
                            <div class="btn-group">
                            <a class="btn btn-primary btn-sm {!canPrint}" href="/apex/PP_Print_Center?id={!pq.Id}">{!$Label.EMEA_Print_Email_Quote}&nbsp;&nbsp;<span class="glyphicon glyphicon-print"></span></a>
                            <a href="#" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown" aria-expanded="false"><span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li class="{!canPrint}" style="margin-left: 0px;">
                                    <apex:commandLink action="/apex/{!printURL}?id={!pq.Id}{!lang}&r=pdf"
                                                      styleClass="{!canPrint}" >
                                        {!$Label.EMEA_View_PDF}&nbsp;&nbsp;<span class="glyphicon glyphicon-eye-open"></span>
                                    </apex:commandLink>
                                </li>
                                <li class="{!canPrint}" style="margin-left: 0px;">
                                    <a href="/apex/PP_Print_Quote_File_Export?r=pdf&id={!pq.id}{!lang}">{!$Label.EMEA_Download_PDF}</a>
                                </li>
                                <li class="{!canPrint}" style="margin-left: 0px;">
                                    <apex:commandLink action="{!sendReport}"
                                                      styleClass="{!canPrint}"
                                                      reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform">
                                        {!$Label.EMEA_Email_to_Self}
                                    </apex:commandLink>
                                </li>
                                <li class="{!canPrint}" style="margin-left: 0px;">
                                    <apex:commandLink action="/apex/PP_SendEmail?id={!pq.Id}{!lang}"
                                                      styleClass="{!canPrint}"
                                                      reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform">
                                        {!$Label.EMEA_Email_to_Customer}
                                    </apex:commandLink>
                                </li>
                                <li class="{!canPrint}" style="margin-left: 0px;">
                                    <apex:commandLink action="/apex/PP_Print_Center?id={!pq.Id}{!lang}"
                                                      styleClass="{!canPrint}"
                                                      reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform">
                                        {!$Label.EMEA_Options}
                                    </apex:commandLink>
                                </li>
                            </ul>
                            </div>
                        </apex:outputText>

                        <!-- EMEA logic to enable/disable Print / Email Quote  -->
                        <apex:outputText rendered="{!emeaUser}">
                            <div class="btn-group">
                            <a class="btn btn-primary btn-sm {!emeaCanPrint}" href="/apex/PP_Print_Center?id={!pq.Id}">{!$Label.EMEA_Print_Email_Quote}&nbsp;&nbsp;<span class="glyphicon glyphicon-print"></span></a>
                            <a href="#" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown" aria-expanded="false"><span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li class="{!emeaCanPrint}" style="margin-left: 0px;">
                                    <apex:commandLink action="/apex/{!printURL}?id={!pq.Id}{!lang}&r=pdf"
                                                      styleClass="{!emeaCanPrint}" >
                                        {!$Label.EMEA_View_PDF}&nbsp;&nbsp;<span class="glyphicon glyphicon-eye-open"></span>
                                    </apex:commandLink>
                                </li>
                                <li class="{!emeaCanPrint}" style="margin-left: 0px;">
                                    <a href="/apex/PP_Print_Quote_File_Export?r=pdf&id={!pq.id}{!lang}">{!$Label.EMEA_Download_PDF}</a>
                                </li>
                                <li class="{!emeaCanPrint}" style="margin-left: 0px;">
                                    <apex:commandLink action="{!sendReport}"
                                                      styleClass="{!emeaCanPrint}"
                                                      reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform">
                                        {!$Label.EMEA_Email_to_Self}
                                    </apex:commandLink>
                                </li>
                                <li class="{!emeaCanPrint}" style="margin-left: 0px;">
                                    <apex:commandLink action="/apex/PP_SendEmail?id={!pq.Id}{!lang}"
                                                      styleClass="{!emeaCanPrint}"
                                                      reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform">
                                        {!$Label.EMEA_Email_to_Customer}
                                    </apex:commandLink>
                                </li>
                                <li class="{!emeaCanPrint}" style="margin-left: 0px;">
                                    <apex:commandLink action="/apex/PP_Print_Center?id={!pq.Id}{!lang}"
                                                      styleClass="{!emeaCanPrint}"
                                                      reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform">
                                        {!$Label.EMEA_Options}
                                    </apex:commandLink>
                                </li>
                            </ul>
                            </div>
                        </apex:outputText>
                        <!-- End of EMEA Print / Email Quote logic -->
                        <apex:outputText rendered="{!!emeaUser}">
                            <a href="/apex/PP_Print_Quote_Export?id={!pq.Id}&rs=xls" class="btn btn-primary btn-sm {!canPrint}">{!$Label.EMEA_Export}&nbsp;&nbsp;<span class="glyphicon glyphicon-floppy-disk"></span></a>
                        </apex:outputText>
                        <apex:outputText rendered="{!emeaUser}">
                            <a href="/apex/PP_Print_Quote_Export?id={!pq.Id}&rs=xls" class="btn btn-primary btn-sm {!emeaCanPrint}">{!$Label.EMEA_Export}&nbsp;&nbsp;<span class="glyphicon glyphicon-floppy-disk"></span></a>
                        </apex:outputText>
                        
                        <!-- End Customer Service -->
                        
                        <apex:outputText rendered="{!!emeaUser}">
                            <apex:outputText rendered="{!pq.Courtesy_Pricing__c}">
                                <div class="btn-group">
                                <a class="btn btn-primary btn-sm">{!$Label.EMEA_Courtesy_Pricing}</a>
                                <a href="#" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown" aria-expanded="false"><span class="caret"></span></a>
                                <ul class="dropdown-menu">
                                    <apex:repeat value="{!cpDropDown}" var="cp">
                                        <li style="margin-left: 0px;">
                                            <apex:commandLink action="{!cpProcess}" status="actStatusId" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,customerform,customerPanel">
                                                {!cp.name} - {!cp.Sales_Deal_Description__c}
                                                <apex:param name="sdnum" value="{!cp.name}"/>
                                            </apex:commandLink>
                                        </li>
                                    </apex:repeat>
                                </ul>
                                </div>
                            </apex:outputText>&nbsp;
                        </apex:outputText>

                        <apex:outputText rendered="{!!emeaUser}">
                            <apex:outputText rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}">
                                <apex:outputText rendered="{!IF($UserRole.Name = 'Teleflex Global IT' || $UserRole.Name = 'Interventional Capital Director' ||
                                                        $UserRole.Name = 'Interventional Capital Service Manager' || CONTAINS($UserRole.Name,'Surgical')
                                                        || CONTAINS($UserRole.Name,'Respiratory') || $UserRole.Name = 'Commercial Operations',true,false)}">
                                    <apex:commandLink action="/apex/PP_Price_QuoteRB?gs=off&pqId={!pq.Id}" styleClass="btn btn-primary btn-sm" value="{!$Label.EMEA_Advance_Edit}" status="actStatusId" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,customerform,customerPanel"/>
                                </apex:outputText>
                            </apex:outputText>
                            

                            <apex:outputText rendered="{!pq.InApproval__c || pq.Status__c = 'Approved'}">
                                <apex:outputText rendered="{!IF($UserRole.Name = 'Teleflex Global IT' || CONTAINS($UserRole.Name,'Surgical'),true,false)}">
                                    <apex:commandLink action="/apex/PP_Price_QuoteRB?gs=off&pqId={!pq.Id}" styleClass="btn btn-primary btn-sm disabled" value="{!$Label.EMEA_Advance_Edit}" status="actStatusId" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,customerform,customerPanel"/>
                                </apex:outputText>
                            </apex:outputText>

                            <!-- Bundles added for Intv Capital(Cardiac) & Vascular... Vascular added (Sprint 2022.12 Work Item: @-025948) -->
                            <apex:outputText rendered="{!$UserRole.Name = 'Teleflex Global IT' || pq.Owner_Business_Unit__c = 'Cardiac' || pq.Owner_Business_Unit__c = 'Interventional Capital' || 
                                                    pq.Owner_Business_Unit__c = 'Vascular'}">
                                <div class="btn-group">
                                <a class="btn btn-primary btn-sm">{!$Label.EMEA_Bundles}</a>
                                <a href="#" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown" aria-expanded="false"><span class="caret"></span></a>
                                <ul class="dropdown-menu">
                                    <li style="margin-left: 0px;">
                                        <apex:outputText rendered="{!$UserRole.Name = 'Teleflex Global IT' || pq.Owner_Business_Unit__c = 'Cardiac' || pq.Owner_Business_Unit__c = 'Interventional Capital'}">
                                            <strong>Interventional Capital</strong>
                                            <apex:commandLink action="{!cardiacFavorites}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">Cardiac 500 Pump</apex:commandLink>
                                            <apex:commandLink action="{!cardiacFavorites700}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">Cardiac 700 Pump</apex:commandLink>
                                        </apex:outputText>
                                        <apex:outputText rendered="{!($UserRole.Name = 'Teleflex Global IT' && pq.BusinessUnit__c = 'Vascular') || pq.Owner_Business_Unit__c = 'Vascular'}">
                                            <strong>Vascular</strong>
                                            <apex:commandLink action="{!vascularBundlesWithUltra4yr}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">VPS Rhythm DLX w/ Ultrasound (4yr)</apex:commandLink>
                                            <apex:commandLink action="{!vascularBundlesWithUltra2yr}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">VPS Rhythm DLX w/ Ultrasound (2yr)</apex:commandLink>
                                            <apex:commandLink action="{!vascularBundlesWithoutUltra4yr}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">VPS Rhythm DLX w/out Ultrasound (4yr)</apex:commandLink>
                                            <apex:commandLink action="{!vascularBundlesWithoutUltra2yr}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">VPS Rhythm DLX w/out Ultrasound (2yr)</apex:commandLink>
                                            <apex:commandLink action="{!vascularBundlesDlxProbe4yr}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">DLX Ultrasound Probe Only (4yr)</apex:commandLink>
                                            <apex:commandLink action="{!vascularBundlesDlxProbe2yr}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">DLX Ultrasound Probe Only (2yr)</apex:commandLink>
                                            <apex:commandLink action="{!vascularBundlesRhythm3yr}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">VPS Rhythm (3yr)</apex:commandLink>
                                            <apex:commandLink action="{!vascularBundlesRhythm1yr}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">VPS Rhythm (1yr)</apex:commandLink>
                                            <apex:commandLink action="{!vascularBundlesRhythmRefurb3yr}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">VPS Rhythm-Refurb (3yr)</apex:commandLink>
                                            <apex:commandLink action="{!vascularBundlesRhythmRefurb1yr}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">VPS Rhythm-Refurb (1yr)</apex:commandLink>
                                            <apex:commandLink action="{!vascularBundlesG42yr}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">G4 (2yr)</apex:commandLink>
                                            <apex:commandLink action="{!vascularBundlesG4refurb2yr}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">G4-Refurb (2yr)</apex:commandLink>
                                        </apex:outputText>
                                    </li>
                                </ul>
                                </div>
                            </apex:outputText>&nbsp;
                        
                            <!-- Bundles Trade-In for Vascular... Vascular added (Sprint 2022.12 Work Item: @-025948) -->
                            <apex:variable var="isTradeIn" value="{!IF($UserRole.Name = 'Teleflex Global IT' || pq.BusinessUnit__c = 'Vascular' || (pq.Type__c = 'Trade-in' && (pq.BusinessUnit__c = 'Anesthesia' || pq.BusinessUnit__c = 'EMS')),true,false)}" />
                            <apex:outputText rendered="{!isTradeIn}">
                                <div class="btn-group">
                                <a class="btn btn-primary btn-sm" id="tradein">Trade-In</a>
                                <a href="#" class="btn btn-primary dropdown-toggle btn-sm" data-toggle="dropdown" aria-expanded="false" id="tradeinList"><span class="caret"></span></a>
                                <ul class="dropdown-menu">
                                    <li style="margin-left: 0px;">
                                        <!--
                                        <apex:outputText rendered="{!($UserRole.Name = 'Teleflex Global IT' && pq.BusinessUnit__c = 'Vascular') || pq.BusinessUnit__c = 'Vascular'}">
                                            <apex:commandLink action="{!vascularTradeIn}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="quotePanel,priceQuotePanel,panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">
                                                TRADEIN-SITE-RITE6
                                                <apex:param name="discType" value="TRADEIN-SITE-RITE6"/>
                                                <apex:param name="discPqId" value="{!pq.Id}"/>
                                            </apex:commandLink>
                                            <apex:commandLink action="{!vascularTradeIn}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="quotePanel,priceQuotePanel,panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">
                                                TRADEIN-SITE-RITE8
                                                <apex:param name="discType" value="TRADEIN-SITE-RITE8"/>
                                                <apex:param name="discPqId" value="{!pq.Id}"/>
                                            </apex:commandLink>
                                            <apex:commandLink action="{!vascularTradeIn}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="quotePanel,priceQuotePanel,panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">
                                                TRADEIN-SHERLOCK
                                                <apex:param name="discType" value="TRADEIN-SHERLOCK"/>
                                                <apex:param name="discPqId" value="{!pq.Id}"/>
                                            </apex:commandLink>
                                            <apex:commandLink action="{!vascularTradeIn}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="quotePanel,priceQuotePanel,panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">
                                                TRADEIN-VPSRHY
                                                <apex:param name="discType" value="TRADEIN-VPSRHY"/>
                                                <apex:param name="discPqId" value="{!pq.Id}"/>
                                            </apex:commandLink>
                                            <apex:commandLink action="{!vascularTradeIn}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="quotePanel,priceQuotePanel,panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">
                                                TRADEIN-VPSG4
                                                <apex:param name="discType" value="TRADEIN-VPSG4"/>
                                                <apex:param name="discPqId" value="{!pq.Id}"/>
                                            </apex:commandLink>
                                            <apex:commandLink action="{!vascularTradeIn}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="quotePanel,priceQuotePanel,panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">
                                                TRADEIN-SONOSITE SII
                                                <apex:param name="discType" value="TRADEIN-SONOSITE SII"/>
                                                <apex:param name="discPqId" value="{!pq.Id}"/>
                                            </apex:commandLink>
                                            <apex:commandLink action="{!vascularTradeIn}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="quotePanel,priceQuotePanel,panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">
                                                TRADEIN-SONOSITE EDGE II
                                                <apex:param name="discType" value="TRADEIN-SONOSITE EDGE II"/>
                                                <apex:param name="discPqId" value="{!pq.Id}"/>
                                            </apex:commandLink>
                                        </apex:outputText>
                                        <apex:outputText rendered="{!($UserRole.Name = 'Teleflex Global IT' && pq.BusinessUnit__c = 'Anesthesia') || pq.BusinessUnit__c = 'Anesthesia'}">
                                            <apex:commandLink action="{!anesTradeIn}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="quotePanel,priceQuotePanel,panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">
                                                McGRATH MAC - Trade-in
                                                <apex:param name="discType" value="McGRATH MAC - Trade-in"/>
                                                <apex:param name="discPqId" value="{!pq.Id}"/>
                                            </apex:commandLink>
                                        </apex:outputText>
                                        
                                        <apex:repeat value="{!TradeIns}" var="item" >
                                            <apex:outputText rendered="{!($UserRole.Name = 'Teleflex Global IT' && pq.BusinessUnit__c = TradeIns[item].Business_Unit__c) || pq.BusinessUnit__c = TradeIns[item].Business_Unit__c}">
                                                <apex:outputText rendered="{!pq.BusinessUnit__c = 'Vascular'}">
                                                    <apex:commandLink action="{!vascularTradeIn}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="quotePanel,priceQuotePanel,panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">
                                                        {!TradeIns[item].Name}
                                                        <apex:param name="discType" value="{!TradeIns[item].Name}"/>
                                                        <apex:param name="discPqId" value="{!pq.Id}"/>
                                                    </apex:commandLink>
                                                </apex:outputText>
                                                 <apex:outputText rendered="{!pq.BusinessUnit__c = 'Anesthesia' || pq.BusinessUnit__c = 'EMS'}">
                                                    <apex:commandLink action="{!anesTradeIn}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="quotePanel,priceQuotePanel,panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">
                                                        {!TradeIns[item].Name}
                                                        <apex:param name="discType" value="{!TradeIns[item].Name}"/>
                                                        <apex:param name="discPqId" value="{!pq.Id}"/>
                                                    </apex:commandLink>
                                                </apex:outputText>
                                            </apex:outputText>
                                        </apex:repeat>
										-->
                                        <!-- Below is new functionality using Product table instead of custom settings -->
                                        <apex:repeat value="{!TradeIn}" var="item" >
                                            <apex:outputText rendered="{!($UserRole.Name = 'Teleflex Global IT' && CONTAINS(TradeIn[item].SBU__c,pq.BusinessUnit__c)) || CONTAINS(TradeIn[item].SBU__c,pq.BusinessUnit__c)}">
                                                <apex:outputText rendered="{!pq.BusinessUnit__c = 'Vascular'}">
                                                    <apex:commandLink action="{!vascularTradeIn}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="quotePanel,priceQuotePanel,panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">
                                                        {!TradeIn[item].Name}
                                                        <apex:param name="discType" value="{!TradeIn[item].Name}"/>
                                                        <apex:param name="discPqId" value="{!pq.Id}"/>
                                                    </apex:commandLink>
                                                </apex:outputText>
                                                 <apex:outputText rendered="{!pq.BusinessUnit__c = 'Anesthesia' || pq.BusinessUnit__c = 'EMS'}">
                                                    <apex:commandLink action="{!anesTradeIn}" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" reRender="quotePanel,priceQuotePanel,panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" status="actStatusId" oncomplete="initialize();">
                                                        {!TradeIn[item].Name}
                                                        <apex:param name="discType" value="{!TradeIn[item].Name}"/>
                                                        <apex:param name="discPqId" value="{!pq.Id}"/>
                                                    </apex:commandLink>
                                                </apex:outputText>
                                            </apex:outputText>
                                        </apex:repeat>  
                                    </li>
                                </ul>
                                </div>
                            </apex:outputText>&nbsp;
                        </apex:outputText>

                        <apex:outputText rendered="{!pq.Opportunity__c != NULL}">
                            <apex:outputText >
                                <apex:commandLink action="/{!pq.Opportunity__c}" styleClass="btn btn-primary btn-sm" value="Return to Opportunity" oncomplete="initialize();"/>
                            </apex:outputText>
                        </apex:outputText>&nbsp;&nbsp;

                        <!-- <button type="button" class="btn btn-sm btn-warning" name="piRemove">Recall</button> -->
                        <apex:commandLink action="{!setPriceToggle}" html-data-html="true" html-data-toggle="tooltip" html-data-placement="top" title="Click to show the REP and \ Pricing Levels" rendered="{!!priceToggle}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" value="{!$Label.EMEA_Show_RSM_REP}" styleClass="btn btn-primary btn-sm" oncomplete="initialize();" status="actStatusId"/>&nbsp;
                        <apex:commandLink action="{!setPriceToggle}" html-data-html="true" html-data-toggle="tooltip" html-data-placement="top" title="Click to hide the REP and RSM Pricing Levels" rendered="{!priceToggle}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" value="{!$Label.Hide_RSM_REP}" styleClass="btn btn-primary btn-sm" oncomplete="initialize();" status="actStatusId"/>

                        <apex:variable value="{!if(pricingTierLevelPlus1=2,'RSM',
                                              if(pricingTierLevelPlus1=3,'DIR',
                                              if(pricingTierLevelPlus1=4,'VP','')))}" var="ptDesc"/>
                        <!-- Request Next Pricing Level (RSM) -->
                        <apex:outputText rendered="{!!csRemove && !latamRemove && !siRemove && requestPlusOne}">
                            <apex:commandLink action="{!requestHigherTierAccess}" value="Request Next Pricing Level ({!ptDesc})" html-data-html="true" html-data-toggle="tooltip" html-data-placement="top" title="Click to request the next level of pricing" styleClass="btn btn-primary btn-sm" oncomplete="initialize();"/>
                        </apex:outputText>

                        <apex:outputText rendered="{!pq2.Price_Tier_Status__c = 'Requested'}">
                            <apex:commandLink value="Approval In Progress for Pricing Level: {!ptDesc}" styleClass="btn btn-primary btn-sm disabled" oncomplete="initialize();"/>
                        </apex:outputText>
                        <apex:outputText rendered="{!pq2.Price_Tier_Status__c = 'Approved'}">
                            <apex:variable value="{!if(pq2.Pricing_Tier_Level__c=2,'RSM',
                                                  if(pq2.Pricing_Tier_Level__c=3,'DIR',
                                                  if(pq2.Pricing_Tier_Level__c=4,'VP','')))}" var="ptDesc"/>
                            <apex:commandLink value="Pricing Level Approved: {!ptDesc}" styleClass="btn btn-primary btn-sm disabled" oncomplete="initialize();"/>
                        </apex:outputText>
                        <apex:outputText rendered="{!pq.InApproval__c}">
                            <apex:commandLink action="{!recall2}" html-data-html="true" html-data-toggle="tooltip" html-data-placement="top" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" value="{!$Label.EMEA_Recall_Approval}" styleClass="btn btn-danger btn-sm" oncomplete="initialize();" status="actStatusId"/>&nbsp;
                        </apex:outputText>
                        <apex:outputText rendered="{!!pq.InApproval__c}">
                            <apex:commandLink action="{!recall2}" html-data-html="true" html-data-toggle="tooltip" html-data-placement="top" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform" value="{!$Label.EMEA_Recall_Approval}" styleClass="btn btn-danger btn-sm disabled" oncomplete="initialize();" status="actStatusId"/>&nbsp;
                        </apex:outputText>
                        <apex:outputPanel Styleclass="panel-body"  layout="block" >
							<div id="errors-js"></div>
                        </apex:outputPanel>
                    </div>
                </apex:outputPanel>
            </div>
            <!-- START -- Line Item Button Bar -->
            <apex:outputText rendered="{!CheckInit}"/>
            <a href="myAnchor" id="myAnchor"/>
            <apex:outputPanel id="redApprovalPanel">
                <!-- Approval Section -->
                <apex:variable var="naRedPanel" value="{!!latamRemove && !siRemove && pq2.Status__c != 'Approved' && pq2.Approval_Level__c != NULL && pq2.Approval_Level__c > pq2.Workflow_Owner_Approval_Level__c}"/>
                <apex:variable var="emeaRedPanel" value="{!emeaUser && NOT(latamRemove) && !siRemove && pq2.Status__c != 'Approved' && pq2.EMEA_Approval_Level__c != NULL && pq2.EMEA_Approval_Level__c > pq2.Workflow_Owner_Approval_Level__c}"/>
                <apex:outputText rendered="{!naRedPanel || emeaRedPanel}">
                    <apex:variable var="approval_Description" value="{!if(pq2.Approval_Level__c == 2,'RSM',
                                                                     if(pq2.Approval_Level__c == 3,'Director',
                                                                     if(pq2.Approval_Level__c == 4,'VP','Sales Rep')))}"/>
                    <apex:variable var="emea_Approval_Description" value="{!if(pq2.EMEA_Approval_Level__c == 2,'RSM',
                                                                     if(pq2.EMEA_Approval_Level__c == 3,'Director',
                                                                     if(pq2.EMEA_Approval_Level__c == 4,'GM','Sales Rep')))}"/>
                    <div id="wrap" style="padding-bottom:0;">
                        <div class="panel panel-default panel-horizontal ">
                            <div class="panel-heading panel-heading-custom" style="background: red; color:white">
                                <center>
                                    <apex:outputText rendered="{!!emeaUser}">
                                        <h3 class="panel-title">{!$Label.EMEA_Approval_Required}<br/><b>Level {!pq2.Approval_Level__c} - {!approval_Description}</b></h3>
                                    </apex:outputText>
                                    <apex:outputText rendered="{!emeaUser}">
                                        <h3 class="panel-title">{!$Label.EMEA_Approval_Required}<br/><b>Level {!pq2.EMEA_Approval_Level__c} - {!emea_Approval_Description}</b></h3>
                                    </apex:outputText>
                                </center>
                            </div>
                            <div class="panel-body" style="padding: 0 !important;margin: 0 !important;">
                                <table class="table table-bordered table-condensed" style="padding: 0 !important;margin: 0 !important;">
                                    <tr>
                                        <td class="text-nowrap"><b>{!$Label.EMEA_Current_Approval_Level}:</b></td>
                                        <td class="text-nowrap"><b>{!$Label.EMEA_Approval_Reason_s}:</b></td>
                                    </tr>
                                    <tr>
                                        <td class="text-nowrap">{!pq2.Owner_Approval_Role__c} (Level {!pq2.Workflow_Owner_Approval_Level__c})</td>
                                        <td>{!approval_reasons}</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="panel-footer panel-heading-custom" style="background: red; color:white">
                                <center>
                                    <apex:outputText rendered="{!!emeaUser}">
                                        <h3 class="panel-title">{!$Label.EMEA_Approval_Required}<br/><b>Level {!pq2.Approval_Level__c} - {!approval_Description}</b></h3>
                                    </apex:outputText>
                                    <apex:outputText rendered="{!emeaUser}">
                                        <h3 class="panel-title">{!$Label.EMEA_Approval_Required}<br/><b>Level {!pq2.EMEA_Approval_Level__c} - {!emea_Approval_Description}</b></h3>
                                    </apex:outputText>
                                </center>
                            </div>
                        </div>
                    </div>
                </apex:outputText>
            </apex:outputPanel>
            <!-- Active Quote -->
            <apex:outputText rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}">
                <!-- Line Item Entry -->
                <apex:actionFunction name="rerenderPanel1" rerender="panel1,priceform,customerform,buttonPannelId,salesform,wrap" onbeforedomupdate="return setFocus()" oncomplete="initialize(),retainFocus();"/>
                <apex:outputPanel Styleclass="panel-body" id="panel1" layout="block">                    
                    <!-- <apex:pageMessages ></apex:pageMessages> -->
                    <table class="table table-hover table-bordered table-condensed fs10" id="sortable">
                    <apex:variable value="{!if(pq.Type__c == 'Sales Per Each', TRUE, FALSE)}" var="isPerEach" />
                        <thead>
                            <tr>
                                <th rowspan="2" class="text-center col-xs-1 tinyMan"><strong>#</strong></th>
                                <th rowspan="2" class="text-center col-xs-1" style="width: 50px;text-align:center; vertical-align:middle;">
                                    <span aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Click to Bold"><strong>B</strong></span>
                                </th>
                                <th rowspan="2" class="text-center col-xs-2"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Material__c.label}" /></th>
                                <th rowspan="2" class="text-center col-xs-1" style="width: 50px;text-align:center; vertical-align:middle;">  <!--style="color:lightgrey"-->
                                    <span class="glyphicon glyphicon-info-sign" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="{!$Label.EMEA_Material_Status}"/>
                                </th>
                                <th rowspan="2" class="text-center col-xs-1"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Sales_Org__c.label}" /></th>
                                <th rowspan="2" class="text-center col-xs-1" style="width: 50px;text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.MRP_Group__c.label}" /></th>
                                <apex:variable value="" var="t" rendered="{!hasCrossRef}" >
                                    <th rowspan="2" class="text-center col-xs-1" style="text-align:center; vertical-align:middle;">Cross<br /> Reference</th>
                                </apex:variable>
                                <th rowspan="2" class="text-center col-xs-3"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Description__c.label}" /></th>
                                <apex:outputText rendered="{!!emeaUser}">
                                    <th rowspan="2" class="text-center col-xs-1"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Sales_Unit_Qty__c.label}" /></th>
                                </apex:outputText>
                                <apex:outputText rendered="{!emeaUser}">
                                    <th rowspan="2" class="text-center col-xs-1"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Min_Order_Qty__c.label}" /></th>
                                </apex:outputText>
                                <th rowspan="2" class="text-center col-xs-1"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Sales_Unit__c.label}" /></th>
                                <th rowspan="2" class="text-center col-xs-2"><strong>{!$Label.EMEA_Sales_Deal}</strong></th>
                                <apex:outputText rendered="{!!csRemove && !latamRemove && !siRemove}">
                                    <th rowspan="2" class="text-center col-xs-2"><strong>{!$Label.EMEA_Requested_Sales_Deal}</strong></th>
                                </apex:outputText>
                                <apex:outputText rendered="{!csRemove}">
                                  <th rowspan="2" class="text-center col-xs-1" style="text-align:center; vertical-align:middle; white-space: normal;">
                                    <strong><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.List_Price__c.label}"/></strong>
                                  </th>
                                </apex:outputText>
                                <apex:outputText rendered="{!!csRemove && !latamRemove && !siRemove}">
                                  <th rowspan="2" class="text-center col-xs-1" style="text-align:center;white-space: normal;">
                                      <strong><apex:commandLink action="{!massUpdList}" html-data-toggle="tooltip" html-data-placement="top" title="{!$Label.EMEA_Set_All_Lines_to_List_Price}" value="{!$ObjectType.Price_Quote_Line_Item__c.fields.List_Price__c.label}" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,salesform,quotePanel,wrap" oncomplete="initialize();" status="actStatusId"/></strong>
                                  </th>
                                </apex:outputText>
                                <apex:outputText rendered="{!latamRemove || siRemove}">
                                    <th class="text-center col-xs-1" style="text-align:center;white-space: normal;">
                                        <strong><apex:commandLink action="{!massUpdList}" html-data-toggle="tooltip" html-data-placement="top" title="{!$Label.EMEA_Set_All_Lines_to_List_Price}" value="{!$ObjectType.Price_Quote_Line_Item__c.fields.List_Price__c.label}" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,salesform,quotePanel,wrap" oncomplete="initialize();" status="actStatusId"/></strong>
                                    </th>
                                    <apex:outputText rendered="{!!emeaUser || (emeaUser && pq.Pricing_Tier_Level__c > 1)}">
                                    <th class="text-center col-xs-1" style="text-align:center;white-space: normal;">
                                        <strong><apex:commandLink action="{!massUpdRSM}" html-data-toggle="tooltip" html-data-placement="top" title="{!$Label.EMEA_Set_All_Lines_to_RSM_Price}" value="{!if(emeaUser,'RSM Minimum Price',$ObjectType.Price_Quote_Line_Item__c.fields.RSM_Price__c.label)}" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,salesform,quotePanel,wrap" oncomplete="initialize();" status="actStatusId"/></strong>
                                    </th>
                                    </apex:outputText>
                                    <th class="text-center col-xs-1" style="text-align:center;white-space: normal;">
                                        <strong><apex:commandLink action="{!massUpdRep}" html-data-toggle="tooltip" html-data-placement="top" title="{!$Label.EMEA_All_lines_Rep_Price}" value="{!if(emeaUser,'Rep Minimum Price',$ObjectType.Price_Quote_Line_Item__c.fields.Rep_Price__c.label)}" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,salesform,quotePanel,wrap" oncomplete="initialize();" status="actStatusId"/></strong>
                                    </th>
                                </apex:outputText>

                                <!-- This Builds out the Top Tiers REP, RSM, DIR -->
                                <apex:outputText rendered="{!!csRemove && !latamRemove && !siRemove}">
                                  <apex:repeat value="{!tierHeaderNames}" var="tl">
                                      <strong><th colspan="{!tierLevels[tl]}" style="text-align:center; vertical-align:middle;">{!tl}</th></strong>
                                  </apex:repeat>
                                </apex:outputText>
                                <!-- END Builds out the tiers -->

                                <!-- Start Attempt to show old way -->
                                <apex:outputText rendered="{!priceToggle}">
                                    <apex:outputText rendered="{!ppUserRec.Pricing_Tier_Access__c > 1}">
                                        <th rowspan="2" class="text-center col-xs-1" id="oldWay" style="text-align:center;white-space: normal;">
                                            <strong><apex:commandLink action="{!massUpdRSM}" html-data-toggle="tooltip" html-data-placement="top" title="{!$Label.EMEA_Set_All_Lines_to_RSM_Price}" value="{!if(emeaUser,'RSM Minimum Price',$ObjectType.Price_Quote_Line_Item__c.fields.RSM_Price__c.label)}" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,salesform,quotePanel,wrap" oncomplete="initialize();" status="actStatusId"/></strong>
                                        </th>
                                    </apex:outputText>
                                    <th rowspan="2" class="text-center col-xs-1" id="oldWay" style="text-align:center;white-space: normal;">
                                        <strong><apex:commandLink action="{!massUpdRep}" html-data-toggle="tooltip" html-data-placement="top" title="{!$Label.EMEA_All_lines_Rep_Price}" value="{!if(emeaUser,'Rep Minimum Price',$ObjectType.Price_Quote_Line_Item__c.fields.Rep_Price__c.label)}" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,salesform,quotePanel,wrap" oncomplete="initialize();" status="actStatusId"/></strong>
                                    </th>
                                </apex:outputText>
                                <!-- End of Attempt to show old way -->

                                <apex:outputText rendered="{!!csRemove}">
                                  <th rowspan="2" class="text-center col-xs-1" style="text-align:center; vertical-align:middle; white-space: normal;">
                                      <strong><apex:commandLink action="{!massUpdEligible}" html-data-toggle="tooltip" html-data-placement="top" title="{!$Label.EMEA_Set_All_lines_To_Eligible_Price}" value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Eligible_Price__c.label}" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,salesform,quotePanel,wrap" oncomplete="initialize();" status="actStatusId"/></strong>
                                  </th>
                                </apex:outputText>
                                <apex:outputText rendered="{!csRemove}">
                                  <th rowspan="2" class="text-center col-xs-1" style="text-align:center; vertical-align:middle; white-space: normal;">
                                      <apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Eligible_Price__c.label}" />
                                  </th>
                                </apex:outputText>
                                <th rowspan="2" class="text-center col-xs-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Sales_Price__c.label}" /></th>
                                <th rowspan="2" class="text-center col-xs-1 tinyMan" style="text-align:center; vertical-align:middle;">&nbsp;</th>
                                <th rowspan="2" class="text-center col-xs-1" style="text-align:center; vertical-align:middle;">
                                    <strong><apex:outputText value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Quantity__c.label}"/></strong>
                                </th>

                                <!-- Latin America -->
                                <apex:outputText rendered="{!!csRemove && isPerEach}">
                                    <th rowspan="2" class="text-center col-xs-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Price_Per_Each__c.label}" /></th>
                                    <th rowspan="2" class="text-center col-xs-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Total_Price_Per_Each__c.label}" /></th>
                                </apex:outputText>
                                <apex:outputText rendered="{!!isPerEach}">
                                    <th rowspan="2" class="text-center col-xs-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Line_Price__c.label}" /></th>
                                </apex:outputText>
                                <apex:outputText rendered="{!emeaUser}">
                                    <th rowspan="2" class="text-center col-xs-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.VAT__c.label}" /></th>
                                    <th rowspan="2" class="text-center col-xs-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Total__c.label}" /></th>
                                </apex:outputText>
                                <th rowspan="2" class="text-center col-xs-1" style="text-align:center; vertical-align:middle;">
                                    <apex:commandLink action="{!bulkrefresh}" html-data-toggle="tooltip" html-data-placement="top" title="{!$Label.EMEA_Refresh_Pricing_All_Lines}" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,customerform,customerPanel,wrap" StyleClass="glyphicon glyphicon-repeat" status="actStatusId" oncomplete="initialize();" rendered="{!pq.Status__c != 'Approved' || $UserRole.Name = 'Teleflex Global IT' || $UserRole.Name = 'Commercial Operations'}">
                                        <apex:param name="pqid" value="{!pq.Id}"/>
                                    </apex:commandLink>
                                </th>

                                <th rowspan="2" class="text-center col-xs-1">
                                    <apex:commandLink action="{!massDelItems}" html-data-toggle="tooltip" html-data-placement="top" title="{!$Label.EMEA_Delete_All_Lines}" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,customerform,customerPanel,salesform,wrap,quotePanelContainer" StyleClass="glyphicon glyphicon-trash" status="actStatusId" oncomplete="initialize();">
                                        <apex:param name="delId" value="{!pq.Id}"/>
                                    </apex:commandLink>
                                </th>
                                <apex:outputText rendered="{!CONTAINS($UserRole.Name,'Teleflex Global IT') || CONTAINS($UserRole.Name,'Commercial Operations') }">
                                    <apex:outputText rendered="{!!emeaUser}">
                                        <th rowspan="2" class="text-center col-xs-1"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Approval_Level__c.label}" /></th>
                                    </apex:outputText>
                                </apex:outputText>
                                <apex:outputText rendered="{!(CONTAINS($UserRole.Name,'Teleflex Global IT') && emeaUser) || emeaUser}">
                                    <th rowspan="2" class="text-center col-xs-1"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.EMEA_Approval_Level__c.label}" /></th>
                                </apex:outputText>
                            </tr>
                            <!-- This Builds out the Bottom Tiers T1, T2, T3 -->
                            <apex:outputText rendered="{!!csRemove && !latamRemove && !siRemove}">
                            <tr>
                                <apex:repeat value="{!tierHeaderList}" var="th">
                                    <th style="text-align:center; vertical-align:middle;">
                                        <apex:commandLink action="{!massUpdateTiers}" value="T{!right(th,1)}" html-data-toggle="tooltip" html-data-placement="top" title="Set All Lines to {!left(th,3)} T{!right(th,1)}" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,salesform,quotePanel,wrap" oncomplete="initialize();" status="actStatusId">
                                            <apex:param name="tierLevel" value="{!th}"/>
                                        </apex:commandLink>
                                    </th>
                                </apex:repeat>
                            </tr>
                            </apex:outputText>
                        </thead>
                        <tbody>
                            <!-- START OF LINE ITEMS -->
                            <apex:variable value="{!1}" var="rowNum"/>
                            <apex:repeat value="{!LineItems}" var="row" id="repeatId">
                                <!-- <div class="line-item" data-material="{!row.Material_}" data-lineItemId="{!row.Id}"> -->
                                <apex:variable value="{!if(LEN(row.Product_Description__c) > 149,'...','')}" var="longPD"/>
                                <apex:variable value="{!if(row.Material_Name__r.Sales_Org__c == 'US30','Arrow',if(row.Material_Name__r.Sales_Org__c == 'US10' || row.Material_Name__r.Sales_Org__c == 'US60','TFX','') )}" var="salesOrgName"/>
                                <apex:outputText rendered="{!row.Material_Name__c != NULL}">
                                    <tr class="text-center" style="vertical-align:middle; " id="{!row.Id}">
                                        <apex:inputHidden id="hiddenId" value="{!row.Id}" />
                                        <td class="text-center col-xs-1 tinyMan"><apex:outputText value="{!FLOOR(rowNum)}"/></td>
                                        <apex:variable var="rowNum" value="{!rowNum + 1}"/>
                                        <td class="text-center col-xs-1" style="width: 50px;vertical-align:middle; ">
                                            <apex:variable value="" var="t" rendered="{!row.IsBold__c}" >
                                                <span class="glyphicon glyphicon-flag" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Click to Unbold" style="color:black" id="flagId{!row.Id}" onclick="highlightBack('{!row.Id}')" onmouseover="this.style.cursor='pointer'"/>
                                            </apex:variable>
                                            <apex:variable value="" var="f" rendered="{!NOT(row.IsBold__c)}">
                                                <span class="glyphicon glyphicon-flag" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Click to Bold" style="color:lightgrey" id="flagId{!row.Id}" onclick="highlightBack('{!row.Id}')" onmouseover="this.style.cursor='pointer'"/>
                                            </apex:variable>
                                        </td>
                                        <td class="text-center col-xs-1" style="vertical-align:middle; white-space: nowrap;">
                                            <table id="lineItemTable">
                                                <tr>
                                                    <td class="text-center text-nowrap" style="vertical-align:middle;" id="prodName">
                                                        <apex:variable var="picColor" value="{!if(ISBLANK(row.Material_Name__r.Image_URL__c),'color:lightgrey','color:green')}"/>
                                                        <apex:outputText rendered="{!!emeaUser}">
                                                        <a href="/apex/PP_Material_Info?id={!row.Material_Name__r.Id}&pqId={!ActiveQuoteIdStr}" >
                                                            
                                                            <span class="glyphicon glyphicon-camera" aria-hidden="true" style="{!picColor};" id="picture1"/>
                                                        </a>
                                                        </apex:outputText>
                                                        &nbsp;
                                                        <a href="/apex/PP_Material_Info?id={!row.Material_Name__r.Id}&pqId={!ActiveQuoteIdStr}">
                                                            <apex:outputText html-data-toggle="tooltip" html-data-placement="top" title="Click for Material Detail" value="{!row.Material_Name__r.Name}" id="matName" />
                                                        </a>
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td class="text-center col-xs-1" id="matCell" style="width: 50px;padding: 0px; vertical-align:middle;background-color:
                                                                                             {!If(row.Material_Status__c == '40' || row.Material_Status__c == 'ZE','#66FF66',
                                                                                             IF( row.Material_Status__c == 'Z4' || row.Material_Status__c == 'Z5'|| row.Material_Status__c == 'Z9' || row.Material_Status__c == 'Z0' || row.Material_Status__c == 'ZU' || row.Material_Status__c == 'ZO' , '#CC3333' ,
                                                                                             IF( row.Material_Status__c == 'Z1' || row.Material_Status__c == 'Z2' || row.Material_Status__c == 'Z3' || row.Material_Status__c == 'Z7' || row.Material_Status__c == 'Z8' , '#CCFF66' ,
                                                                                             IF( row.Material_Status__c == 'Z6' || row.Material_Status__c == 'ZR' , '#0099FF' , 'White' ) ) )  )};" >
                                            <span class="glyphicon glyphicon-info-sign" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="{!row.Material_Status_Description__c}"/>
                                        </td>
                                        <td class="text-center col-xs-1" style="vertical-align:middle; white-space: nowrap;">
                                            <apex:outputText value="{!salesOrgName}" />
                                        </td>
                                        <td class="text-center col-xs-1" style="vertical-align:middle; white-space: nowrap;">
                                            <apex:outputText value="{!row.MRP_Group__c}" />
                                        </td>
                                        <apex:variable value="" var="t" rendered="{!hasCrossRef}" >
                                            <td class="text-center col-xs-1" style="padding: 0px; vertical-align:middle; ">
                                                {!row.Competetive_Product__r.Competitor_Product_Code__c}
                                            </td>
                                        </apex:variable>
                                        <!-- Product Description  style="min-width:250px; padding: 5px; vertical-align:middle; "-->
                                        <apex:outputText rendered="{!!emeaUser}">
                                            <td class="text-center col-xs-3" style="padding: 5px;">
                                                <a href="/apex/PP_Material_Info?id={!row.Material_Name__r.Id}&pqId={!ActiveQuoteIdStr}">
                                                    <apex:outputText html-data-toggle="tooltip" html-data-placement="top" title="Click for Material Detail: {!row.Material_Name__r.Name} ({!row.Material_Name__r.Sales_Org__c}{!row.Material_Name__r.Distribution_Channel__c})(AL:{!row.Approval_Level__c}/OAL{!row.Owner_Approval_Level__c})" value="{!left(row.Product_Description__c,150)}{!longPD}"/>
                                                </a>
                                            </td>
                                        </apex:outputText>
                                        
                                        <!-- Show Production Description for EMEA Users... Description is returned in SAP Callout -->
                                        <apex:outputText rendered="{!emeaUser}">
                                            <td class="text-center col-xs-3" style="padding: 5px;">
                                                <a href="/apex/PP_Material_Info?id={!row.Material_Name__r.Id}&pqId={!ActiveQuoteIdStr}">
                                                    <apex:outputText html-data-toggle="tooltip" html-data-placement="top" title="Click for Material Detail: {!row.Material_Name__r.Name} ({!row.Material_Name__r.Sales_Org__c}{!row.Material_Name__r.Distribution_Channel__c})(AL:{!row.Approval_Level__c}/OAL{!row.Owner_Approval_Level__c})" value="{!left(row.Material_Description__c,150)}{!longPD}"/>
                                                </a>
                                            </td>
                                        </apex:outputText>

                                        <!-- Units of Measure -->
                                        <td class="text-center col-xs-1" style="padding: 0px; vertical-align:middle; ">
                                            <apex:outputText value="{!row.Sales_Unit_Qty__c}" rendered="{!!emeaUser}"/>
                                            <apex:outputText value="{!row.Min_Order_Qty__c}" rendered="{!emeaUser}"/>
                                        </td>
                                        <td class="text-center col-xs-1" style="padding: 0px; vertical-align:middle; ">
                                            <apex:outputText value="{!row.Sales_Unit__c}"/>
                                        </td>
                                        <!-- New Contract Cells -->
                                        <!-- Existing Contract -->
                                        <td class="text-center col-xs-1 text-nowrap" style="padding: 5px; margin-top: 0px; margin-bottom: 0px; vertical-align:middle; width: 250px;">
                                            <apex:outputText rendered="{!row.Sales_Deal_Description__c != NULL && row.Objective__c != NULL}">
                                                <a href="/apex/PP_Agreement_Detail?aid={!row.Sales_Number__c}">{!row.Sales_Deal_Description__c}<br/>
                                                    {!row.Sales_Number__c} - {!row.Objective_Name__c} - {!row.Condition__c}</a>
                                            </apex:outputText>
                                            <apex:outputText rendered="{!row.Sales_Deal_Description__c == NULL && row.Material_Name__r.Name != NULL}">Not on Contract</apex:outputText>
                                            <apex:outputText rendered="{!row.Sales_Deal_Description__c != NULL && row.Objective__c = NULL}">
                                                <a href="/apex/PP_Agreement_Detail?aid={!row.Sales_Number__c}">{!row.Sales_Deal_Description__c}<br/>
                                                    {!row.Sales_Number__c} - {!row.Condition__c}</a>
                                            </apex:outputText>
                                        </td>
                                        <!-- Requested Pricing Contract -->
                                        <apex:outputText rendered="{!!csRemove && !latamRemove && !siRemove}">
                                            <apex:outputText rendered="{!row.Requested_Pricing__r.Agreement_Number__c == NULL}">
                                                <td class="text-center text-nowrap" style="text-align:center; vertical-align:middle;">-</td>
                                            </apex:outputText>
                                            <apex:outputText rendered="{!row.Requested_Pricing__r.Agreement_Number__c != NULL}">
                                                <td class="text-center text-nowrap" style="text-align:center; vertical-align:middle;">
                                                    <a href="/apex/PP_Agreement_Detail?aid={!row.Requested_Pricing__r.Agreement_Number__c}">{!row.Requested_Pricing__r.Description__c}
                                                        <br/>{!row.Requested_Pricing_Description__c}&nbsp;</a>
                                                </td>
                                            </apex:outputText>
                                        </apex:outputText>
                                        <!-- List Price -->
                                        <!-- Customer Service -->
                                        <apex:outputText rendered="{!csRemove}">
                                            <td class="text-center" style="vertical-align:middle; "><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatListPrices[row.Id]}</td>
                                            <td class="text-center" style="0px; vertical-align:middle; "><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatEligiblePrices[row.Id]}</td>
                                            <td class="text-center" style="padding: 0px; vertical-align:middle; "><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatSalesPrices[row.Id]}</td>
                                        </apex:outputText>
                                        <apex:outputText rendered="{!!csRemove}">
                                            <td class="text-center col-xs-1" style="vertical-align:middle; ">
                                                <apex:commandLink action="{!updateListPrice}" html-data-toggle="tooltip" html-data-placement="top" title="Set Line to List Price" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanel,salesform,wrap" value="{!formatListPrices[row.Id]}" oncomplete="initialize();"  status="actStatusId">
                                                    <apex:param name="listPrice" value="{!row.List_Price__c}"/>
                                                    <apex:param name="lineId" value="{!row.Id}"/>
                                                    <apex:param name="lineQty" value="{!row.Quantity__c}"/>
                                                </apex:commandLink>
                                            </td>
                                            <!-- Pricing Matrix -->
                                            <apex:outputText rendered="{!!csRemove && !latamRemove && !siRemove}">
                                            <apex:repeat value="{!tierHeaderList}" var="th">
                                                <apex:variable var="mname" value="{!th}-{!row.Material_Name_Text__c}" />
                                                <apex:variable var="selected" value="{!if((row.Requested_Pricing__r.Agreement_Number__c = tierMap[mname].Name && row.Sales_Price__c = tierMap[mname].Price) || 
                                                                                     (row.Sales_Deal__r.Agreement_Number__c = tierMap[mname].Name && row.Sales_Price__c = tierMap[mname].Price),TRUE,FALSE)}" />
                                                <apex:variable var="PTSelected" value="{!if(row.Requested_Pricing__r.Agreement_Number__c = tierMap[mname].Name && row.Sales_Price__c = tierMap[mname].Price,'#ffa300','')}" />

                                                <!-- {!row.Requested_Pricing__r.Agreement_Number__c} = {!tierMap[mname].Name} - {!row.Sales_Deal__r.Agreement_Number__c} = {!tierMap[mname].Name} -->
                                                <!-- No Pricing Tier -->
                                                <apex:outputText rendered="{!tierMap[mname].Price = 0}">
                                                    <td class="text-center" style="text-align:center; vertical-align:middle;">-</td>
                                                </apex:outputText>
                                                <!-- Selected -->
                                                <apex:outputText rendered="{!selected && tierMap[mname].Price != 0}">
                                                    <td class="text-center" style="background-color: {!PTSelected};"><b><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!tierMap[mname].Price}</b></td>
                                                </apex:outputText>
                                                <!-- Optional Tier -->
                                                <apex:outputText rendered="{!!selected && tierMap[mname].Price != 0}">
                                                    <td class="text-center" style="text-align:center; vertical-align:middle;">
                                                        <apex:commandLink action="{!updateTierPrice}" value="{!tierMap[mname].Price}" html-data-html="true" html-data-toggle="tooltip" html-data-placement="top" title="Set Line to {!left(th,3)} Tier {!right(th,1)} Pricing <br/> {!tierMap[mname].chDesc}" oncomplete="initialize();">
                                                            <apex:param name="tierPrice" value="{!tierMap[mname].Price}"/>
                                                            <apex:param name="lineId" value="{!row.Id}"/>
                                                            <apex:param name="key" value="{!mname}"/>
                                                        </apex:commandLink>
                                                    </td>
                                                </apex:outputText>
                                            </apex:repeat>
                                            </apex:outputText>
                                            <!-- END Pricing Matrix -->

                                            <!-- Old REP/RSM Blocks -->
                                            <apex:outputText rendered="{!latamRemove || siRemove}">
                                                <td class="text-center col-xs-1" style="vertical-align:middle; ">
                                                    <apex:commandLink action="{!updateRSMprice}" html-data-toggle="tooltip" html-data-placement="top" title="Set Line to RSM Price" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanel,salesform,wrap" value="{!formatRSMPrices[row.Id]}" oncomplete="initialize();" status="actStatusId">
                                                        <apex:param name="RSMPrice" value="{!row.RSM_Price__c}"/>
                                                        <apex:param name="lineId" value="{!row.Id}"/>
                                                        <apex:param name="lineQty" value="{!row.Quantity__c}"/>
                                                    </apex:commandLink>
                                                </td>
                                                <td class="text-center col-xs-1" style="vertical-align:middle; ">
                                                    <apex:commandLink action="{!updateRepPrice}" html-data-toggle="tooltip" html-data-placement="top" title="Set Line to Rep Price" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanel,salesform,wrap" value="{!formatRepPrices[row.Id]}" oncomplete="initialize();" status="actStatusId">
                                                        <apex:param name="repPrice" value="{!row.Rep_Price__c}"/>
                                                        <apex:param name="lineId" value="{!row.Id}"/>
                                                        <apex:param name="lineQty" value="{!row.Quantity__c}"/>
                                                    </apex:commandLink>
                                                </td>
                                            </apex:outputText>

                                            <!-- Show old way attempt -->
                                            <apex:outputText rendered="{!priceToggle}">
                                                <apex:outputText rendered="{!ppUserRec.Pricing_Tier_Access__c > 1}">
                                                    <td class="text-center col-xs-1" id="oldWay" style="vertical-align:middle; ">
                                                        <apex:commandLink action="{!updateRSMprice}" html-data-toggle="tooltip" html-data-placement="top" title="Set Line to RSM Price" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanel,salesform,wrap" value="{!formatRSMPrices[row.Id]}" oncomplete="initialize();" status="actStatusId">
                                                            <apex:param name="RSMPrice" value="{!row.RSM_Price__c}"/>
                                                            <apex:param name="lineId" value="{!row.Id}"/>
                                                            <apex:param name="lineQty" value="{!row.Quantity__c}"/>
                                                        </apex:commandLink>
                                                    </td>
                                                </apex:outputText>
                                                <td class="text-center col-xs-1" id="oldWay" style="vertical-align:middle; ">
                                                    <apex:commandLink action="{!updateRepPrice}" html-data-toggle="tooltip" html-data-placement="top" title="Set Line to Rep Price" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanel,salesform,wrap" value="{!formatRepPrices[row.Id]}" oncomplete="initialize();" status="actStatusId">
                                                        <apex:param name="repPrice" value="{!row.Rep_Price__c}"/>
                                                        <apex:param name="lineId" value="{!row.Id}"/>
                                                        <apex:param name="lineQty" value="{!row.Quantity__c}"/>
                                                    </apex:commandLink>
                                                </td>
                                            </apex:outputText>
                                            <!-- End old way attempt -->

                                            <!-- Eligible Price -->
                                            <td class="text-center col-xs-1" style="0px; vertical-align:middle; ">
                                                <apex:commandLink action="{!updateEligiblePrice}" html-data-toggle="tooltip" html-data-placement="top" title="Set Line to Eligible Price" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanel,quotePanelContainer,salesform,wrap" value="{!formatEligiblePrices[row.Id]}" oncomplete="initialize();" status="actStatusId">
                                                    <apex:param name="eligiblePrice" value="{!row.Eligible_Price__c}"/>
                                                    <apex:param name="lineId" value="{!row.Id}"/>
                                                    <apex:param name="lineQty" value="{!row.Quantity__c}"/>
                                                </apex:commandLink>
                                            </td>
                                            <td class="text-center col-xs-1" style="padding: 0px; vertical-align:middle; ">
                                                <!-- <apex:inputText value="{!row.Sales_Price__c}" size="12"/> -->
                                                <input size="15" value="{!row.Sales_Price__c}" tabindex="{!row.Row_Order__c}" class="newPrice" data-id="{!row.Id}" id="{!row.Id}+.1"/>
                                            </td>
                                        </apex:outputText>

                                        <td class="text-center col-xs-1 tinyMan">
                                            <!-- Zero means no errors, One means errors -->
                                            <apex:outputText rendered="{!!emeaUser}">
                                                <apex:outputText rendered="{!row.Approval_Flag_Checkbox__c = FALSE}">
                                                    <span data-toggle="tooltip" data-placement="top" title="{!row.Approval_Flag_Reason__c}" class="glyphicon glyphicon-ok-sign" aria-hidden="true" style="color:green;"/>
                                                </apex:outputText>
                                                <apex:outputText rendered="{!row.Approval_Flag_Checkbox__c = TRUE}">
                                                    <span data-toggle="tooltip" data-placement="top" title="{!row.Approval_Flag_Reason__c}" class="glyphicon glyphicon-remove-sign" aria-hidden="true" style="color:red;" />
                                                </apex:outputText>
                                            </apex:outputText>

                                            <apex:outputText rendered="{!emeaUser}">
                                                <apex:outputText rendered="{!row.EMEA_Approval_Flag_Checkbox__c = FALSE}">
                                                    <span data-toggle="tooltip" data-placement="top" title="{!row.EMEA_Approval_Flag_Reason__c}" class="glyphicon glyphicon-ok-sign" aria-hidden="true" style="color:green;"/>
                                                </apex:outputText>
                                                <apex:outputText rendered="{!row.EMEA_Approval_Flag_Checkbox__c = TRUE}">
                                                    <span data-toggle="tooltip" data-placement="top" title="{!row.EMEA_Approval_Flag_Reason__c}" class="glyphicon glyphicon-remove-sign" aria-hidden="true" style="color:red;" />
                                                </apex:outputText>
                                            </apex:outputText>

                                        </td>

                                        <!-- Start Trade-in Logic below is to toggle quantity field for input for tradein functionality for Vascular, ANES/EMS -->
                                        <apex:variable var="tradeon" value="{!if(row.Material__c = 'ARJ12001RU' || row.Material__c ='ARJ13302RU' || row.Material__c = 'McGRATH MAC-Trade-in',true,false)}" />
                                        <!-- Rendered for Trade-ins for Vascular/Anes/EMS -->
                                        <apex:outputText rendered="{!CONTAINS(row.Product_Description__c,'Trade-in')}">
                                            <apex:outputText rendered="{!pq.BusinessUnit__c = 'Vascular'}">
                                                <td class="text-center col-xs-1" style="padding: 0px; vertical-align:middle; ">
                                                    {!row.Quantity__c}
                                                </td>
                                            </apex:outputText>
                                            <apex:variable var="picColor" value="{!if(ISBLANK(row.Material_Name__r.Image_URL__c),'color:lightgrey','color:green')}"/>
                                            <apex:outputText rendered="{!pq.BusinessUnit__c = 'Anesthesia' || pq.BusinessUnit__c = 'EMS'}">
                                                <td class="text-center col-xs-1" style="padding: 0px; vertical-align:middle; " id="newQtyTrade">
                                                     <!-- added line below for Trade-ins (different class name to reference different @RemoteAction) -->
                                                    <apex:outputText rendered="{!tradeon}">
                                                    	<input size="6" value="{!row.Quantity__c}" tabindex="{!row.Row_Order__c}" class="newQtyTrade" data-id="{!row.Id}" id="{!row.Id}+.2" />
                                                    </apex:outputText>
                                                	<apex:outputText rendered="{!!tradeon}">
                                                    	<input size="6" value="{!row.Quantity__c}" tabindex="{!row.Row_Order__c}" class="newQty" data-id="{!row.Id}" id="{!row.Id}+.2" />
                                                    </apex:outputText>
                                                    <!-- end of Tradeins -->
                                                </td>
                                            </apex:outputText>
                                        </apex:outputText>

                                        <!-- Rendered for non Trade-ins -->
                                        <apex:outputText rendered="{!!CONTAINS(row.Product_Description__c,'Trade-in')}">
                                            <td class="text-center col-xs-1" style="padding: 0px; vertical-align:middle; " id="newQtyNoTrade">
                                                <apex:outputText rendered="{!!emeaUser}">
                                                	<!-- added line below for Trade-ins (different class name to reference different @RemoteAction) -->
                                                    <apex:outputText rendered="{!tradeon}">
                                                    	<input size="6" value="{!row.Quantity__c}" tabindex="{!row.Row_Order__c}" class="newQtyTrade" data-id="{!row.Id}" id="{!row.Id}+.2" />
                                                    </apex:outputText>
                                                    <apex:outputText rendered="{!!tradeon}">
                                                    	<input size="6" value="{!row.Quantity__c}" tabindex="{!row.Row_Order__c}" class="newQty" data-id="{!row.Id}" id="{!row.Id}+.2" />
                                                    </apex:outputText>
                                                    <!-- end of Tradeins -->
                                                </apex:outputText>
                                                <apex:outputText rendered="{!emeaUser}">
                                                    <input size="6" value="{!row.Quantity__c}" tabindex="{!row.Row_Order__c}" class="newQtyEMEA" data-id="{!row.Id}" id="{!row.Id}+.2" min="{!row.Min_Order_Qty__c}"/>
                                                </apex:outputText>
                                            </td>
                                        </apex:outputText>
                                        <!-- End Trade-in check for quantity input -->

                                        <!-- Latin America Price Per Each -->
                                        <apex:outputText rendered="{!!csRemove && isPerEach}">
                                            <td class="text-center" style="padding: 0px; vertical-align:middle; ">{!row.Price_Per_Each__c}</td>
                                            <td class="text-center" style="padding: 0px; vertical-align:middle; ">{!row.Total_Price_Per_Each__c}</td>
                                        </apex:outputText>
                                        
                                        <apex:outputText rendered="{!!isPerEach}">
                                        <td class="text-center col-xs-1" style="padding: 0px; vertical-align:middle; ">
                                            <apex:outputText value="{!formatLinePrices[row.Id]}"/>
                                        </td>
                                        </apex:outputText>

                                        <!-- Show VAT Percentage for EMEA Users -->
                                        <apex:outputText rendered="{!emeaUser}">
                                            <td class="text-center col-xs-1" style="padding: 0px; vertical-align:middle; ">
                                                {!row.VAT__c}
                                            </td>
                                            <td class="text-center col-xs-1" style="padding: 0px; vertical-align:middle; ">
                                                {!row.Total__c}
                                            </td>
                                        </apex:outputText>

                                        <td class="text-center col-xs-1" style="text-align:center; vertical-align:middle;">
                                            <apex:commandLink action="{!Refresh}" html-data-toggle="tooltip" html-data-placement="top" title="Refresh Pricing" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,customerform,customerPanel,salesform,wrap" StyleClass="glyphicon glyphicon-repeat" oncomplete="initialize();" status="actStatusId" rendered="{!pq.Status__c != 'Approved' || $UserRole.Name = 'Teleflex Global IT' || $UserRole.Name = 'Commercial Operations'}">
                                                <apex:param name="itemId" value="{!row.Material_Name__c}"/>
                                                <apex:param name="lineItemId" value="{!row.Id}"/>
                                            </apex:commandLink>
                                        </td>
                                        <td class="text-center col-xs-1" style="text-align:center; vertical-align:middle;">
                                            <apex:commandLink action="{!removingRow}" html-data-toggle="tooltip" html-data-placement="top" title="Delete Line" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,customerform,customerPanel,salesform,wrap" StyleClass="glyphicon glyphicon-trash" oncomplete="initialize();" status="actStatusId">
                                                <apex:param name="itemId" value="{!row.Id}"/>
                                            </apex:commandLink>
                                        </td>
                                        <apex:outputText rendered="{!CONTAINS($UserRole.Name,'Teleflex Global IT') || CONTAINS($UserRole.Name,'Commercial Operations') }">
                                            <apex:outputText rendered="{!!emeaUser}">
                                                <td class="text-center col-xs-1" style="text-align:center; vertical-align:middle;">{!row.Approval_Level__c}</td>
                                            </apex:outputText>
                                        </apex:outputText>
                                        <apex:outputText rendered="{!(CONTAINS($UserRole.Name,'Teleflex Global IT') && emeaUser) || emeaUser}">
                                            <td class="text-center col-xs-1" style="text-align:center; vertical-align:middle;">{!row.EMEA_Approval_Level__c}</td>
                                        </apex:outputText>
                                    </tr>
                                </apex:outputText>
                                <apex:variable var="colspnBlank" value="{!if(hasCrossRef= TRUE,22,21)}"/>
                                <apex:outputText rendered="{!row.Material_Name__c = NULL && row.Competetive_Product__r.Competitor_Product_Code__c = NULL}">
                                    <tr id="{!row.Id}">
                                      <td id="blankCol" class="text-center" colspan="{!colspnBlank}">
                                        <strong>
                                            <input value="{!row.Product_Description__c}" data-id="{!row.Id}" class="blankInput" type="textarea" size="50" style="text-align: center"/>
                                        </strong>
                                      </td>
                                      <td class="text-center col-sm-1" style="text-align:center; vertical-align:middle;" colspan="2">
                                        <apex:commandLink action="{!removingRow}" html-data-toggle="tooltip" html-data-placement="top" title="Delete Line" reRender="panel1,buttonPannelId,priceform,itemsform,panelTotalId,customerform,customerPanel,wrap,quotePanelContainer" StyleClass="glyphicon glyphicon-trash" status="actStatusId" oncomplete="initialize();">
                                                <apex:param name="itemId" value="{!row.Id}"/>
                                        </apex:commandLink>
                                      </td>
                                      <apex:outputText rendered="{! (CONTAINS($UserRole.Name,'Teleflex Global IT') || CONTAINS($UserRole.Name,'Commercial Operations')) && pq.BusinessUnit__c != 'EMEA'}">
                                          <td class="text-center col-xs-1" style="text-align:center; vertical-align:middle;">{!row.Approval_Level__c}</td>
                                      </apex:outputText>
                                      <apex:outputText rendered="{!(CONTAINS($UserRole.Name,'Teleflex Global IT') && emeaUser) || emeaUser}">
                                          <td class="text-center col-xs-1" style="text-align:center; vertical-align:middle;">{!row.EMEA_Approval_Level__c}</td>
                                      </apex:outputText>
                                    </tr>
                                </apex:outputText>
                                <!-- </div> -->
                            </apex:repeat>
                            <!-- Hiding to figure out colspan issue
                            <apex:outputText rendered="{!emeaUser}">
                                <apex:variable var="colspnTotals" value="{!if(csRemove,19+thSpan,20+thSpan)}"/>
                                <tr style="border: none;">
                                    <td colspan="{!colspnTotals}" style="border: none; text-align: right;"></td>
                                    <td style="border: none; text-align: right;">Grand Total</td>
    
                                </tr>
    
                                <tr style="border: none;">
                                    <td colspan="{!colspnTotals}" style="border: none; text-align: right;"></td>
                                    <td style="border: none; text-align: right;">{!calculateVatTotal}</td>
    
                                </tr>
                            </apex:outputText>
                            -->
                            <!-- END OF LINE ITEMS -->
                        </tbody>
                        <!-- Input Panel-->
                        <tr>
                            <apex:variable var="colspn" value="{!if(csRemove,9+thSpan,10+thSpan)}"/>
                            <td colspan="{!colspn}" style="border-right-width: 0px;">
                                <apex:outputPanel id="buttonPannelId2">
                                    <table>
                                        <tr>
                                            <td class="col-xs-6" style="vertical-align:middle;">
                                                <div class="form-inline">
                                                    <apex:outputlink value="/apex/PP_ProductSearch?pqId={!pq.Id}" styleclass="input-group">
                                                        <span class="glyphicon glyphicon-search"></span>
                                                    </apex:outputlink>&nbsp;
                                                    <apex:inputText value="{!strProdSearch}" size="35" id="autocomplete_textbox" onkeyup="autoMaterialName(event, '{!$Component.addBtnId}');" styleClass="form-control input-sm" html-placeholder="{!$Label.EMEA_Material}" />
                                                    <apex:commandLink action="{!sapPrice}" reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,customerform,wrap,quotePanel,totalPanel" id="addBtnId" value="{!if(pq.Account_Name__r.SAP_Sold_To__c == NULL, 'Add Line Item SF', $Label.EMEA_Add_Line_Item)}" status="actStatusId" styleClass="btn btn-success btn-sm" oncomplete="initialize();" />
                                                    <apex:inputText value="{!strQtyChange}" id="massQty" styleClass="form-control input-sm" html-placeholder="{!$Label.EMEA_Enter_Qty}"/>
                                                    <span>
                                                        <!-- Customer Service -->
                                                        <apex:outputText >
                                                            <apex:commandLink action="{!massQtyChange}" reRender="buttonPannelId,panel1,wrap" id="qtyId" value="{!$Label.EMEA_Mass_Qty}" styleClass="btn btn-success btn-sm" oncomplete="initialize();" status="actStatusId" >
                                                                <apex:param name="changeQty" value="{!strQtyChange}"/>
                                                            </apex:commandLink>&nbsp;&nbsp;
                                                        </apex:outputText> 
                                                        <apex:commandLink action="{!blankRow}" reRender="buttonPannelId,panel1,errorPanel,wrap" id="blankRow" value="{!$Label.EMEA_Blank_Row}" styleClass="btn btn-success btn-sm" oncomplete="initialize();" status="actStatusId"/>&nbsp;&nbsp;
                                                        <apex:commandLink action="{!fixString}" id="fixString" reRender="buttonPannelId,panel1,errorPanel,wrap" value="{!$Label.EMEA_Fix_Material_Desc}" styleClass="btn btn-success btn-sm" oncomplete="initialize();" status="actStatusId"/>&nbsp;
                                                        <!-- Customer Service -->
                                                        <apex:outputText rendered="{!!csRemove}">
                                                            <a href="/apex/PP_QuickEditPq?pqid={!pq.Id}&gs=off" Class="btn btn-success btn-sm">{!$Label.EMEA_Quick_Edit}</a>
                                                        </apex:outputText>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                    </span>

                                                </div>
                                                <script>
                                                document.getElementById('{!$Component.autocomplete_textbox}').focus();
                                                document.getElementById('{!$Component.autocomplete_textbox}').value='';
                                                </script>
                                            </td>
                                        </tr>
                                    </table>
                                </apex:outputPanel>
                            </td>
                            <!-- Grand Total -->
                            <!-- Possibly to convert symbols w/ UTF-8 Issues
                            <apex:outputText value="&euro;" escape="false">{!SalesOrgMap[pq.Sales_Org_Key__c]}</apex:outputText>
                            -->
                            <td>
                                <apex:outputPanel id="totalPanel" rendered="{!calculateVatTotal != NULL || pq2.Discounted_Total__c != NULL}">                                    
                                    <apex:variable value="{!if(hasCrossRef = TRUE, 8, 7)}" var="colsp"/>
                                    <apex:outputText rendered="{!!isPerEach}">
                                        
                                        <apex:outputText rendered="{!!emeaUser}">
                                            
                                            <td colspan="4" style="padding: 0px; vertical-align:middle; border-left-width: 0px;border-right-width: 0px;"></td>
                                            <td colspan="{!colsp}" class="text-right" style="vertical-align:middle;border-left-width: 0px;border-right-width: 0px;">
                                                <strong>
                                                    {!$Label.EMEA_Grand_Total}({!pq.CurrencyIsoCode}):&nbsp;
                                                    <apex:outputText rendered="{!!contains($UserRole.Name,'Capital')}"><strong>{!formatTotalPrices[pq.Id]}</strong></apex:outputText>
                                                    <apex:outputText rendered="{!contains($UserRole.Name,'Capital')}"><strong>{!round(pq2.Discounted_Total__c,2)}</strong></apex:outputText>
                                                </strong>
                                            </td> 
                                        </apex:outputText>
                                        <apex:outputText rendered="{!emeaUser}">
                                            
                                            <td colspan="6" style="vertical-align:middle;border-left-width: 0px;border-right-width: 0px; text-align: left;"></td>
                                            <td colspan="{!colsp}" class="text-right" style="vertical-align:middle;border-left-width: 0px;border-right-width: 0px;">
                                                <strong>{!$Label.EMEA_Grand_Total}({!pq.CurrencyIsoCode}):&nbsp;{!calculateVatTotal}</strong>
                                            </td>
                                        </apex:outputText>
                                    </apex:outputText>
                                    <apex:outputText rendered="{!isPerEach}">
                                        
                                        <td colspan="10"></td>
                                    </apex:outputText>
                                    <td colspan="3" style="border-left-width: 0px;">&nbsp;</td>
                                </apex:outputPanel>
                            </td>
                        </tr>
                        <!-- End Input Panel -->
                    </table>
                    <apex:actionstatus id="actStatusId">
                        <apex:facet name="start">
                            <div class="waitingSearchDiv" id="is_loading" style="background-color: #DCD6D6;
                                                                                 height: 100%;opacity:0.65;width:100%; position:fixed">
                                <div class="waitingHolder" style="middle: 100px; width: 100px;">
                                    <img class="waitingImage" src="{!$Resource.LoadingGif}" title="Please Wait..." />
                                    <span class="waitingDescription">Loading...</span>
                                </div>
                            </div>
                        </apex:facet>
                    </apex:actionstatus>
                    
                    <apex:pageMessages ></apex:pageMessages>
                    <apex:outputPanel Styleclass="panel-body"  layout="block" id="errorsjs">
                        <div id="errors-js"></div>
                    </apex:outputPanel>
                </apex:outputPanel>
                <!-- End Line Items -->

            </apex:outputText>

            <!-- Start of Approved Layout -->
            <!-- Line Item Entry -->
            <!-- Locked Quote -->
            <apex:outputText rendered="{!pq.InApproval__c || pq.Status__c = 'Approved'}">
                <apex:outputPanel Styleclass="panel-body" id="panelApproved" layout="block">
                    <apex:pageMessages ></apex:pageMessages>
                    <table class="table table-hover table-bordered" >
                        <apex:outputText rendered="{!CheckInit}"/>
                        <thead>
                            <tr>
                                <th rowspan="2" class="text-center col-sm-1" style="width: 50px;text-align:center; vertical-align:middle;"><span aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Click to Bold">B</span></th>
                                <th rowspan="2" class="text-center col-sm-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Material__c.label}"/></th>
                                <th rowspan="2" class="text-center col-xs-1" style="width: 50px;text-align:center; vertical-align:middle;">  <!--style="color:lightgrey"-->
                                    <span class="glyphicon glyphicon-info-sign" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Material Status"/>
                                </th>
                                <th rowspan="2" class="text-center col-sm-3"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Sales_Org__c.label}"/></th>
                                <th rowspan="2" class="text-center col-xs-1" style="width: 50px;text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.MRP_Group__c.label}"/></th>
                                <apex:variable value="" var="t" rendered="{!hasCrossRef}" >
                                    <th rowspan="2" class="text-center col-sm-1" style="text-align:center; vertical-align:middle;">Cross<br /> Reference</th>
                                </apex:variable>
                                <th rowspan="2" class="text-center col-sm-3" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Description__c.label}"/></th>
                                <apex:outputText rendered="{!!emeaUser}">
                                    <th rowspan="2" class="text-center col-sm-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Sales_Unit_Qty__c.label}" /></th>
                                </apex:outputText>
                                <apex:outputText rendered="{!emeaUser}">
                                    <th rowspan="2" class="text-center col-sm-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Min_Order_Qty__c.label}" /></th>
                                </apex:outputText>
                                <th rowspan="2" class="text-center col-sm-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Sales_Unit__c.label}"/></th>
                                <th rowspan="2" class="text-center col-sm-3" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Sales_Deal__c.label}"/></th>
                                <apex:outputText rendered="{!!csRemove && !latamRemove && !siRemove}">
                                  <th rowspan="2" style="text-align:center; vertical-align:middle;">Requested Sales Deal</th>
                                </apex:outputText>
                                <th rowspan="2" style="text-align:center;white-space: normal;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.List_Price__c.label}"/></th>
                                <!-- Customer Service -->
                                <apex:outputText rendered="{!latamRemove || siRemove}">
                                    <apex:outputText rendered="{!!emeaUser || (emeaUser && pq.Pricing_Tier_Level__c > 1)}">
                                    <th style="text-align:center;white-space: normal;"><apex:outputLabel value="{!if(emeaUser,'RSM Minimum Price',$ObjectType.Price_Quote_Line_Item__c.fields.RSM_Price__c.label)}"/></th>
                                    </apex:outputText>
                                    <th style="text-align:center;white-space: normal;"><apex:outputLabel value="{!if(emeaUser,'Rep Minimum Price',$ObjectType.Price_Quote_Line_Item__c.fields.Rep_Price__c.label)}"/></th>
                                </apex:outputText>
                                <!-- This Builds out the Top Tiers REP, RSM, DIR -->
                                <apex:outputText rendered="{!!csRemove && !latamRemove && !siRemove}">
                                  <apex:repeat value="{!tierHeaderNames}" var="tl">
                                      <th colspan="{!tierLevels[tl]}" style="text-align:center; vertical-align:middle;">{!tl}</th>
                                  </apex:repeat>
                                </apex:outputText>

                                <!-- Start Attempt to show old way -->
                                <apex:outputText rendered="{!priceToggle}">
                                    <apex:outputtext rendered="{!!emeaUser || (emeaUser && pq.Pricing_Tier_Level__c > 1)}">
                                    <th rowspan="2" class="text-center col-xs-1" id="oldWay" style="text-align:center;white-space: normal;">
                                        <apex:outputLabel value="{!if(emeaUser,'RSM Minimum Price',$ObjectType.Price_Quote_Line_Item__c.fields.RSM_Price__c.label)}"/>
                                    </th>
                                    </apex:outputtext>
                                    <th rowspan="2" class="text-center col-xs-1" id="oldWay" style="text-align:center;white-space: normal;">
                                        <apex:outputLabel value="{!if(emeaUser,'Rep Minimum Price',$ObjectType.Price_Quote_Line_Item__c.fields.Rep_Price__c.label)}"/>
                                    </th>
                                </apex:outputText>
                                <!-- End of Attempt to show old way -->

                                <!-- END Builds out the tiers -->
                                <th rowspan="2" style="text-align:center;white-space: normal;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Eligible_Price__c.label}"/></th>
                                <th rowspan="2" class="text-center col-sm-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Sales_Price__c.label}"/></th>
                                <th rowspan="2" class="text-center col-sm-1" style="text-align:center; vertical-align:middle;">&nbsp;</th>
                                <th rowspan="2" class="text-center col-sm-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Quantity__c.label}" /></th>
                                <apex:outputText rendered="{!pq.Type__c == 'Sales Per Each'}">
                                    <th rowspan="2" class="text-center col-sm-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Price_Per_Each__c.label}"/></th>
                                    <th rowspan="2" class="text-center col-sm-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Total_Price_Per_Each__c.label}"/></th>
                                </apex:outputText>
                                <apex:outputText rendered="{!pq.Type__c != 'Sales Per Each'}">
                                    <th rowspan="2" class="text-center col-sm-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Line_Price__c.label}"/></th>
                                </apex:outputText>
                                <apex:outputtext rendered="{!emeaUser}">
                                    <th rowspan="2" class="text-center col-sm-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.VAT__c.label}"/></th>
                                    <th rowspan="2" class="text-center col-sm-1" style="text-align:center; vertical-align:middle;"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Total__c.label}"/></th>
                                </apex:outputtext>
                                <apex:outputText rendered="{!CONTAINS($UserRole.Name,'Teleflex Global IT') || CONTAINS($UserRole.Name,'Commercial Operations')}">
                                    <apex:outputText rendered="{!!emeaUser}">
                                        <th rowspan="2" class="text-center col-sm-1"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.Approval_Level__c.label}"/></th>
                                    </apex:outputText>
                                </apex:outputText>
                                <apex:outputText rendered="{!(CONTAINS($UserRole.Name,'Teleflex Global IT') && emeaUser) || emeaUser}">
                                    <th rowspan="2" class="text-center col-sm-1"><apex:outputLabel value="{!$ObjectType.Price_Quote_Line_Item__c.fields.EMEA_Approval_Level__c.label}"/></th>
                                </apex:outputText>
                            </tr>
                            <!-- This Builds out the Bottom Tiers T1, T2, T3 -->
                            <apex:outputText rendered="{!!csRemove && !latamRemove && !siRemove}">
                            <tr>
                                <apex:repeat value="{!tierHeaderList}" var="th">
                                    <th style="text-align:center; vertical-align:middle;">
                                        T{!right(th,1)}
                                    </th>
                                </apex:repeat>
                            </tr>
                            </apex:outputText>
                        </thead>
                        <tbody>
                            <!-- START OF READ ONLY LINE ITEMS / Approval Layout -->
                            <apex:repeat value="{!LineItems}" var="row" id="repeatId2">
                                <apex:variable value="{!if(LEN(row.Product_Description__c) > 149,'...','')}" var="longPD"/>
                                <apex:variable value="{!if(row.Material_Name__r.Sales_Org__c == 'US30','Arrow',if(row.Material_Name__r.Sales_Org__c == 'US10' || row.Material_Name__r.Sales_Org__c == 'US60','TFX','') )}" var="salesOrgName"/>
                                <apex:outputText rendered="{!row.Material_Name__c != NULL}">
                                    <tr class="text-center" style="vertical-align:middle; " id="{!row.Id}">
                                        <td class="text-center" style="width: 50px;vertical-align:middle; ">
                                            <apex:variable value="" var="t" rendered="{!row.IsBold__c}" >
                                                <span class="glyphicon glyphicon-flag" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Click to Unbold" style="color:black" id="flagId{!row.Id}" onclick="highlightBack('{!row.Id}')" onmouseover="this.style.cursor='pointer'"/>
                                                <!-- <a href="" class="glyphicon glyphicon-flag" style="color:black" id="flagId{!row.Id}" onclick="highlightBack('{!row.Id}')" onmouseover="this.style.cursor='pointer'"/> -->
                                            </apex:variable>
                                            <apex:variable value="" var="f" rendered="{!NOT(row.IsBold__c)}">
                                                <span class="glyphicon glyphicon-flag" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Click to Bold" style="color:lightgrey" id="flagId{!row.Id}" onclick="highlightBack('{!row.Id}')" onmouseover="this.style.cursor='pointer'"/>
                                                <!-- <a href="" class="glyphicon glyphicon-flag" style="color:lightgrey" id="flagId{!row.Id}" onclick="highlightBack('{!row.Id}')" onmouseover="this.style.cursor='pointer'"/> -->
                                            </apex:variable>
                                        </td>
                                        <td class="text-center" style="vertical-align:middle; white-space: nowrap;">
                                            <table>
                                                <tr>
                                                    <td class="text-center text-nowrap" style="vertical-align:middle;">
                                                        <apex:variable var="picColor" value="{!if(ISBLANK(row.Material_Name__r.Image_URL__c),'color:lightgrey','color:green')}"/>
                                                        <a href="/apex/PP_Material_Info?id={!row.Material_Name__r.Id}&pqId={!ActiveQuoteIdStr}" >
                                                            <span class="glyphicon glyphicon-camera" aria-hidden="true" style="{!picColor};" id="picture1"/>
                                                        </a>
                                                        &nbsp;
                                                        <apex:outputText value="{!row.Material_Name__r.Name}" id="matName" />
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td class="text-center" id="matCell" style="width: 50px;padding: 0px; vertical-align:middle;background-color:
                                                                                    {!If(row.Material_Status__c == '40' || row.Material_Status__c == 'ZE','#66FF66',
                                                                                    IF( row.Material_Status__c == 'Z4' || row.Material_Status__c == 'Z5'|| row.Material_Status__c == 'Z9' || row.Material_Status__c == 'Z0' || row.Material_Status__c == 'ZU' , '#CC3333' ,
                                                                                    IF( row.Material_Status__c == 'Z1' || row.Material_Status__c == 'Z2' || row.Material_Status__c == 'Z3' || row.Material_Status__c == 'Z7' || row.Material_Status__c == 'Z8' , '#CCFF66' ,
                                                                                    IF( row.Material_Status__c == 'Z6' || row.Material_Status__c == 'ZR' , '#0099FF' , 'White' ) ) )  )};" >
                                            <span class="glyphicon glyphicon-info-sign" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="{!row.Material_Status_Description__c}"/>
                                        </td>
                                        <td class="text-center col-xs-1" style="vertical-align:middle; white-space: nowrap;">
                                            <apex:outputText value="{!salesOrgName}" />
                                        </td>
                                        <td class="text-center col-xs-1" style="vertical-align:middle; white-space: nowrap;">
                                            <apex:outputText value="{!row.MRP_Group__c}" />
                                        </td>
                                        <apex:variable value="" var="t" rendered="{!hasCrossRef}" >
                                            <td class="text-center" style="padding: 0px; vertical-align:middle; ">
                                                {!row.Competetive_Product__r.Competitor_Product_Code__c}
                                            </td>
                                        </apex:variable>
                                        <apex:outputText rendered="{!!emeaUser}">
                                        <td class="text-center" style="min-width:300px; padding: 5px; vertical-align:middle; ">
                                            <a href="/apex/PP_Material_Info?id={!row.Material_Name__r.Id}&pqId={!ActiveQuoteIdStr}" >
                                                <apex:outputText html-data-toggle="tooltip" html-data-placement="top" title="Click for Material Detail: {!row.Material_Name__r.Name} ({!row.Material_Name__r.Sales_Org__c}{!row.Material_Name__r.Distribution_Channel__c})" value="{!left(row.Product_Description__c,150)}{!longPD}"/>
                                            </a>
                                        </td>
                                        </apex:outputText>
                                        <!-- Show Production Description for EMEA Users... Description is returned in SAP Callout -->
                                        <apex:outputText rendered="{!emeaUser}">
                                            <td class="text-center col-xs-3" style="padding: 5px;">
                                                <a href="/apex/PP_Material_Info?id={!row.Material_Name__r.Id}&pqId={!ActiveQuoteIdStr}">
                                                    <apex:outputText html-data-toggle="tooltip" html-data-placement="top" title="Click for Material Detail: {!row.Material_Name__r.Name} ({!row.Material_Name__r.Sales_Org__c}{!row.Material_Name__r.Distribution_Channel__c})(AL:{!row.Approval_Level__c}/OAL{!row.Owner_Approval_Level__c})" value="{!left(row.Material_Description__c,150)}{!longPD}"/>
                                                </a>
                                            </td>
                                        </apex:outputText>
                                        <apex:outputText rendered="{!!emeaUser}">
                                            <td class="text-center" style="padding: 0px; vertical-align:middle; ">{!row.Sales_Unit_Qty__c}</td>
                                        </apex:outputText>
                                        <apex:outputText rendered="{!emeaUser}">
                                            <td class="text-center" style="padding: 0px; vertical-align:middle; ">{!row.Min_Order_Qty__c}</td>
                                        </apex:outputText>
                                        <td class="text-center" style="padding: 0px; vertical-align:middle; ">{!row.Sales_Unit__c}</td>
                                        <td class="text-center text-nowrap" style="padding: 5px; margin-top: 0px; margin-bottom: 0px; vertical-align:middle; width: 250px;">
                                            <apex:outputText rendered="{!row.Sales_Deal_Description__c != NULL && row.Objective__c != NULL}">
                                                <a href="/apex/PP_Agreement_Detail?aid={!row.Sales_Number__c}">{!row.Sales_Deal_Description__c}<br/>
                                                    {!row.Sales_Number__c} - {!row.Objective_Name__c} - {!row.Condition__c}</a>
                                            </apex:outputText>
                                            <apex:outputText rendered="{!row.Sales_Deal_Description__c == NULL && row.Material_Name__r.Name != NULL}">No Contract</apex:outputText>
                                            <apex:outputText rendered="{!row.Sales_Deal_Description__c != NULL && row.Objective__c = NULL}">
                                                <a href="/apex/PP_Agreement_Detail?aid={!row.Sales_Number__c}">{!row.Sales_Deal_Description__c}<br/>
                                                    {!row.Sales_Number__c} - {!row.Condition__c}</a>
                                            </apex:outputText>
                                        </td>
                                        <!-- Requested Pricing Contract -->
                                        <apex:outputText rendered="{!!csRemove && !latamRemove && !siRemove}">
                                          <td class="text-center" style="text-align:center; vertical-align:middle;"><a href="/apex/PP_Agreement_Detail?aid={!row.Requested_Pricing__r.Agreement_Number__c}">{!row.Requested_Pricing_Description__c}&nbsp;</a></td>
                                        </apex:outputText>
                                        <td class="text-center" style="vertical-align:middle; "><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatListPrices[row.Id]}</td>
                                        <!-- Customer Service -->
                                        <apex:outputText rendered="{!latamRemove || siRemove}">
                                            <apex:outputText rendered="{!!emeaUser || (emeaUser && pq.Pricing_Tier_Level__c > 1)}">
                                            <td class="text-center" style="vertical-align:middle; "><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatRSMPrices[row.Id]}</td>
                                            </apex:outputText>
                                            <td class="text-center" style="vertical-align:middle; "><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatRepPrices[row.Id]}</td>
                                        </apex:outputText>
                                        <!-- Pricing Matrix -->
                                            <apex:outputText rendered="{!!csRemove && !latamRemove && !siRemove}">
                                            <apex:repeat value="{!tierHeaderList}" var="th">
                                                <apex:variable var="mname" value="{!th}-{!row.Material_Name_Text__c}" />
                                                <apex:variable var="selected" value="{!if(row.Requested_Pricing__r.Agreement_Number__c = tierMap[mname].Name || row.Sales_Deal__r.Agreement_Number__c = tierMap[mname].Name,TRUE,FALSE)}" />
                                                <!-- {!row.Requested_Pricing__r.Agreement_Number__c} = {!tierMap[mname].Name} - {!row.Sales_Deal__r.Agreement_Number__c} = {!tierMap[mname].Name} -->
                                                <!-- No Pricing Tier -->
                                                <apex:outputText rendered="{!tierMap[mname].Price = 0}">
                                                    <td class="text-center" style="text-align:center; vertical-align:middle;">-</td>
                                                </apex:outputText>
                                                <!-- Selected -->
                                                <apex:outputText rendered="{!selected && tierMap[mname].Price != 0}">
                                                    <td class="text-center row-striped" style="text-align:center; vertical-align:middle;"><b><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!tierMap[mname].Price}</b></td>
                                                </apex:outputText>
                                                <!-- Optional Tier -->
                                                <apex:outputText rendered="{!!selected && tierMap[mname].Price != 0}">
                                                    <td class="text-center" style="text-align:center; vertical-align:middle;">
                                                        <apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!tierMap[mname].Price}
                                                    </td>
                                                </apex:outputText>
                                            </apex:repeat>
                                            </apex:outputText>
                                            <!-- END Pricing Matrix -->

                                            <!-- Show old way attempt -->
                                            <apex:outputText rendered="{!priceToggle}">
                                                <apex:outputText rendered="{!!emeaUser || (emeaUser && pq.Pricing_Tier_Level__c > 1)}">
                                                <td class="text-center col-xs-1" id="oldWay" style="vertical-align:middle; ">
                                                    <apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatRSMPrices[row.Id]}
                                                </td>
                                                </apex:outputText>
                                                <td class="text-center col-xs-1" id="oldWay" style="vertical-align:middle; ">
                                                    <apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatRepPrices[row.Id]}
                                                </td>
                                            </apex:outputText>
                                            <!-- End old way attempt -->

                                        <td class="text-center" style="0px; vertical-align:middle; "><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatEligiblePrices[row.Id]}</td>
                                        <td class="text-center" style="padding: 0px; vertical-align:middle; "><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatSalesPrices[row.Id]}</td>
                                        <td class="text-center" style="padding: 0px; vertical-align:middle;" >
                                            <!-- Zero means no errors, One means errors -->
                                            <a>
                                                <apex:outputText rendered="{!!emeaUser}">
                                                    <apex:outputText rendered="{!row.Approval_Flag_Checkbox__c = FALSE}">
                                                        <span data-toggle="tooltip" data-placement="top" title="{!row.Approval_Flag_Reason__c}" class="glyphicon glyphicon-ok-sign" aria-hidden="true" style="color:green;"/>
                                                    </apex:outputText>
                                                    <apex:outputText rendered="{!row.Approval_Flag_Checkbox__c = TRUE}">
                                                        <span data-toggle="tooltip" data-placement="top" title="{!row.Approval_Flag_Reason__c}" class="glyphicon glyphicon-remove-sign" aria-hidden="true" style="color:red;" />
                                                    </apex:outputText>
                                                </apex:outputText>

                                                <apex:outputText rendered="{!emeaUser}">
                                                    <apex:outputText rendered="{!row.EMEA_Approval_Flag_Checkbox__c = FALSE}">
                                                        <span data-toggle="tooltip" data-placement="top" title="{!row.EMEA_Approval_Flag_Reason__c}" class="glyphicon glyphicon-ok-sign" aria-hidden="true" style="color:green;"/>
                                                    </apex:outputText>
                                                    <apex:outputText rendered="{!row.EMEA_Approval_Flag_Checkbox__c = TRUE}">
                                                        <span data-toggle="tooltip" data-placement="top" title="{!row.EMEA_Approval_Flag_Reason__c}" class="glyphicon glyphicon-remove-sign" aria-hidden="true" style="color:red;" />
                                                    </apex:outputText>
                                                </apex:outputText>
                                            </a>
                                        </td>
                                        <td class="text-center" style="padding: 0px; vertical-align:middle; ">{!row.Quantity__c}</td>
                                        <apex:outputText rendered="{!pq.Type__c == 'Sales Per Each'}">
                                            <td class="text-center" style="padding: 2px; vertical-align:middle; "><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!row.Price_Per_Each__c}</td>
                                            <td class="text-center" style="padding: 2px; vertical-align:middle; "><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!row.Total_Price_Per_Each__c}</td>
                                        </apex:outputText>
                                        <apex:outputText rendered="{!pq.Type__c != 'Sales Per Each'}">
                                            <td class="text-center" style="padding: 2px; vertical-align:middle; "><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatLinePrices[row.Id]}</td>
                                        </apex:outputText>
                                        <apex:outputtext rendered="{!emeaUser}">
                                            <td class="text-center" style="padding: 2px; vertical-align:middle; ">{!row.VAT__c}</td>
                                            <td class="text-center" style="padding: 2px; vertical-align:middle; ">{!row.Total__c}</td>
                                        </apex:outputtext>
                                        <apex:outputText rendered="{!CONTAINS($UserRole.Name,'Teleflex Global IT') || $UserRole.Name = 'Commercial Operations'}">
                                            <apex:outputText rendered="{!!emeaUser}">
                                                <td class="text-center col-xs-1" style="text-align:center; vertical-align:middle;">{!row.Approval_Level__c}</td>
                                            </apex:outputText>
                                        </apex:outputText>
                                        <apex:outputText rendered="{!(CONTAINS($UserRole.Name,'Teleflex Global IT') && emeaUser) || emeaUser}">
                                            <td class="text-center col-xs-1" style="text-align:center; vertical-align:middle;">{!row.EMEA_Approval_Level__c}</td>
                                        </apex:outputText>
                                    </tr>
                                </apex:outputText>
                                <apex:outputText rendered="{!row.Material_Name__c = NULL && NOT(hasCrossRef)}">
                                    <tr id="{!row.Id}">
                                        <td class="text-center" style="width: 50px;vertical-align:middle; ">
                                            <apex:variable value="" var="t" rendered="{!row.IsBold__c}" >
                                                <span class="glyphicon glyphicon-flag" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Click to Unbold" style="color:black" id="flagId{!row.Id}" onclick="highlightBack('{!row.Id}')" onmouseover="this.style.cursor='pointer'"/>
                                                <!-- <a href="" class="glyphicon glyphicon-flag" style="color:black" id="flagId{!row.Id}" onclick="highlightBack('{!row.Id}')" onmouseover="this.style.cursor='pointer'"/> -->
                                            </apex:variable>
                                            <apex:variable value="" var="f" rendered="{!NOT(row.IsBold__c)}">
                                                <span class="glyphicon glyphicon-flag" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Click to Bold" style="color:lightgrey" id="flagId{!row.Id}" onclick="highlightBack('{!row.Id}')" onmouseover="this.style.cursor='pointer'"/>
                                                <!-- <a href="" class="glyphicon glyphicon-flag" style="color:lightgrey" id="flagId{!row.Id}" onclick="highlightBack('{!row.Id}')" onmouseover="this.style.cursor='pointer'"/> -->
                                            </apex:variable>
                                        </td>
                                        <td colspan="15" class="text-center" >
                                            <strong>
                                                <apex:outputText value="{!left(row.Product_Description__c,150)}{!longPD}" style="text-align: center"/>
                                            </strong>
                                        </td>
                                    </tr>
                                </apex:outputText>
                                <apex:outputText rendered="{!row.Material_Name__c = NULL && hasCrossRef}">
                                    <tr id="{!row.Id}">
                                        <td class="text-center" style="width: 50px;vertical-align:middle; ">
                                            <apex:variable value="" var="t" rendered="{!row.IsBold__c}" >
                                                <span class="glyphicon glyphicon-flag" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Click to Unbold" style="color:black" id="flagId{!row.Id}" onclick="highlightBack('{!row.Id}')" onmouseover="this.style.cursor='pointer'"/>
                                                <!-- <a href="" class="glyphicon glyphicon-flag" style="color:black" id="flagId{!row.Id}" onclick="highlightBack('{!row.Id}')" onmouseover="this.style.cursor='pointer'"/> -->
                                            </apex:variable>
                                            <apex:variable value="" var="f" rendered="{!NOT(row.IsBold__c)}">
                                                <span class="glyphicon glyphicon-flag" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="Click to Bold" style="color:lightgrey" id="flagId{!row.Id}" onclick="highlightBack('{!row.Id}')" onmouseover="this.style.cursor='pointer'"/>
                                                <!-- <a href="" class="glyphicon glyphicon-flag" style="color:lightgrey" id="flagId{!row.Id}" onclick="highlightBack('{!row.Id}')" onmouseover="this.style.cursor='pointer'"/> -->
                                            </apex:variable>
                                        </td>
                                        <td id="blankCol" class="text-center" colspan="21">
                                            <strong>
                                                <apex:outputText value="{!row.Product_Description__c}" style="text-align: center"/>
                                            </strong>
                                        </td>
                                    </tr>
                                </apex:outputText>
                            </apex:repeat>
                            <!-- END OF READ ONLY LINE ITEMS -->
                        </tbody>
                        <!-- Input Panel-->
                        <!-- Customer Service -->
                        <apex:outputText rendered="{!!csRemove}">
                            <tr>
                                <!-- Grand Total -->
                                <apex:outputText rendered="{!pq.Type__c != 'Sales Per Each'}">
                                    <apex:outputText rendered="{!NOT(hasCrossRef) && !latamRemove}">
                                        <td colspan="15" class="text-right" style="vertical-align:middle;border-left-width: 0px;border-right-width: 0px;"><strong>{!$ObjectType.Price_Quote__c.fields.Grand_Total__c.label} ({!pq.CurrencyIsoCode}):</strong></td>
                                        <td class="text-center" style="padding: 0px; vertical-align:middle; border-left-width: 0px;border-right-width: 0px;"><strong><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatTotalPrices[pq.Id]}&nbsp;</strong></td>
                                    </apex:outputText>
                                    <apex:outputText rendered="{!NOT(hasCrossRef) && latamRemove}">
                                        <td colspan="14" class="text-right" style="vertical-align:middle;border-left-width: 0px;border-right-width: 0px;"><strong>{!$ObjectType.Price_Quote__c.fields.Grand_Total__c.label} ({!pq.CurrencyIsoCode}):</strong></td>
                                        <td class="text-center" style="padding: 0px; vertical-align:middle; border-left-width: 0px;border-right-width: 0px;"><strong><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatTotalPrices[pq.Id]}&nbsp;</strong></td>
                                    </apex:outputText>
                                    <apex:outputText rendered="{!hasCrossRef && !latamRemove}">
                                        <td colspan="15" class="text-right" style="vertical-align:middle;border-left-width: 0px;border-right-width: 0px;"><strong>{!$ObjectType.Price_Quote__c.fields.Grand_Total__c.label} ({!pq.CurrencyIsoCode}):</strong></td>
                                        <td class="text-center" style="padding: 0px; vertical-align:middle; border-left-width: 0px;border-right-width: 0px;"><strong><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatTotalPrices[pq.Id]}&nbsp;</strong></td>
                                    </apex:outputText>
                                    <apex:outputText rendered="{!hasCrossRef && latamRemove}">
                                        <td colspan="15" class="text-right" style="vertical-align:middle;border-left-width: 0px;border-right-width: 0px;"><strong>{!$ObjectType.Price_Quote__c.fields.Grand_Total__c.label} ({!pq.CurrencyIsoCode}):</strong></td>
                                        <td class="text-center" style="padding: 0px; vertical-align:middle; border-left-width: 0px;border-right-width: 0px;"><strong><apex:outputText rendered="{!!emeaUser}">$</apex:outputText>{!formatTotalPrices[pq.Id]}&nbsp;</strong></td>
                                    </apex:outputText>
                                </apex:outputText>
                            </tr>
                        </apex:outputText>
                        <!-- End Input Panel -->
                    </table>
                    <apex:pageMessages ></apex:pageMessages>
                </apex:outputPanel>
            </apex:outputText>
            <!-- End Line Items -->
            <!-- End of Approved Layout -->

            <!-- Second Rendering of Buttons -->
            <apex:outputPanel id="buttonPannelId3">
                <table>
                    <tr>
                        <!-- Quote In Progress or Rejected -->
                        <apex:outputText rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}">
                            <td>
                                <apex:outputlink value="/apex/PP_ProductSearch?pqId={!pq.Id}" styleClass="btn btn-primary btn-sm">
                                    {!$Label.EMEA_Material_Search}&nbsp;&nbsp;<span class="glyphicon glyphicon-search"></span>
                                </apex:outputlink>
                            </td>
                            <td>
                                <apex:outputlink value="/apex/PP_CompProductSearch?pqId={!pq.Id}" styleClass="btn btn-primary btn-sm">
                                    {!$Label.EMEA_Cross_Reference}&nbsp;&nbsp;<span class="glyphicon glyphicon-search"></span>
                                </apex:outputlink>
                            </td>
                            <td>
                                <apex:outputText rendered="{!IF($UserRole.Name = 'Teleflex Global IT' || CONTAINS($UserRole.Name,'Surgical'),true,false)}">
                                    <apex:outputlink value="/apex/PP_Price_QuoteRB?pqId={!pq.Id}" styleClass="btn btn-primary btn-sm">
                                        {!$Label.EMEA_Advance_Edit}
                                    </apex:outputlink>
                                </apex:outputText>
                            </td>
                        </apex:outputText>
                    </tr>
                </table><br />
            </apex:outputPanel>
            <!-- End of Second Rendering of Buttons -->
            <apex:actionFunction name="updateFlag" action="{!updateFlag}" rerender="sortable,panel1,wrap" oncomplete="initialize();">
                <apex:param name="trId" value=""/>
            </apex:actionFunction>
            <!-- </div>
            </div>-->
            <script type="text/javascript">
                console.log("hasError----> {!hasError}");
                if("{!hasError}" == "true"){
                    var b =  document.getElementById("a-update");
                    b.click();
                }
            </script>
        </apex:form>
        <!-- Dun's Form -->

        <!-- Bulk Insert only renders if Quote is not in the Approval Process -->
        <apex:form id="bulkform" rendered="{!NOT(pq.InApproval__c) && pq.Status__c != 'Approved'}" html-ng-non-bindable="true">
            <table class="table table-striped table-hover table-bordered" id="bulktable">
                <tr><th>{!$Label.EMEA_Bulk_Material_Insert}:</th></tr>
                <tr><td>
                    <apex:param name="pqid" value="{!pq.Id}"/>
                    <apex:inputTextArea value="{!strMats}" html-placeholder="{!$Label.EMEA_Copy_and_Paste_Materials_Here}" cols="50" rows="1" id="autoresize"/>&nbsp;&nbsp;
                    </td>
                </tr>
                <tr><td>
                    <apex:commandButton value="{!$Label.EMEA_Insert_Limit}" action="{!bulkInsert2}" styleClass="btn btn-primary btn-sm" status="actStatusId"
                                        reRender="panel1,buttonPannelId,priceform,itemsform,quotePanelContainer,wrap" oncomplete="initialize();"/>&nbsp;&nbsp;
                    <apex:commandButton value="{!$Label.EMEA_Clear}" onclick="this.form.reset();return false;" styleClass="btn btn-primary btn-sm" oncomplete="initialize();"/>&nbsp;&nbsp;
                    <apex:commandButton value="{!$Label.EMEA_Import_CSV}" rendered="{!!csRemove}" action="/apex/PP_ImportCsv?gs=off&pqId={!pq.Id}" styleClass="btn btn-primary btn-sm" oncomplete="initialize();"/>
                    <!--&nbsp;
                    <apex:commandButton value="Insert Using Cached Pricing (Limit 1000)" action="{!gknBulkInsert}" styleClass="btn btn-primary btn-sm"
                    reRender="panel1,buttonPannelId,priceform,itemsform,bulkform,quotePanelContainer" oncomplete="initialize();" status="actStatusId"/>
                    -->
                    </td>
                </tr>
            </table>
        </apex:form>
        <!-- Bulk Insert only renders if Quote is not in the Approval Process -->

        <!-- Approval History Related List -->
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h6 class="panel-title"><img src="/img/icon/cash24.png" alt="{!$Label.EMEA_LineItems}"/>&nbsp;&nbsp;{!$Label.EMEA_Related_Lists}</h6>
            </div>
        </div>

        <apex:outputPanel >
            <apex:relatedList list="ProcessSteps" subject="{!$CurrentPage.parameters.pqid}" /><br />
            <apex:relatedList list="PRF__r" subject="{!$CurrentPage.parameters.pqid}"/><br />
            <apex:relatedList list="Opportunities__r" subject="{!$CurrentPage.parameters.pqid}"/><br />
            <apex:relatedList list="OpenActivities" subject="{!$CurrentPage.parameters.pqid}"/><br />
            <apex:relatedList list="ActivityHistories" subject="{!$CurrentPage.parameters.pqid}"/><br />
            <apex:relatedList list="CombinedAttachments" subject="{!$CurrentPage.parameters.pqid}"/>
        </apex:outputPanel>
        <!-- Approval History Related List -->

        <!-- </apex:pageBlock> -->
    </div> <!-- End of Main Div Teleflex -->
    <!-- End of Dun's Form -->
    <script type="text/javascript">
    //function to handle auto-updating of sale price and quantity
    function initialize(){
        console.log('READY!!!!!!!!');
        //console.log('*** NO DLX-200-MTRB ***');
        //$("[id$=tradein]").hide();
        //$('#tradeinList').hide();
        //console.log( '*** sortable *** ' + document.getElementById('sortable').rows[0].cells.length );
        //console.log( '*** notSortable *** ' + document.getElementById('notSortable').rows[0].cells.length );
        if(document.getElementById('sortable').rows[0].cells.length > 0){
            var firColSpan = document.getElementById('sortable').rows[0].cells.length - 1;
            console.log('*** firColSpan *** ' + firColSpan);
            var secColSpan = document.getElementById('sortable').rows[1].cells.length - 1;
            console.log('*** secColSpan *** ' + secColSpan);
            var finalColSpan = firColSpan + secColSpan;
            console.log('*** finalColSpan *** ' + finalColSpan);
            $('#blankCol').attr('colspan',finalColSpan);
        }

        //update quantity
        $('[data-toggle="tooltip"]').tooltip();

        //newQtyEMEA handles logic for EMEA Min Order Qty
        //Quantity entered must be a multiple of the Min Order Qty field
        $('.newQtyEMEA').on('focusin', function(){
            console.log('*** .newQtyEMEA focus ***');
            //console.log("Saving value " + $(this).val());
            $(this).data('val', $(this).val());
        });
        
        $('.newQtyEMEA').change(function() {
            console.log('*** .newQtyEMEA jquery ***');
            var inputValue = parseFloat($(this).val());
            var minOrderQty = parseFloat($(this).attr('min'));
            
            console.log('*** inputValue *** ' + inputValue);
            console.log('*** minOrderQty *** ' + minOrderQty);

            if (inputValue === 0 || inputValue === 0.00) {
                rerenderPanel1();
                //$('[id$=errors-js]').html('Please enter a value other than 0...').css('color','red');
                //$('.newQty').val($(this).data('val'));
            } else if ($.isNumeric(inputValue) === false) {
                rerenderPanel1();
                //$('[id$=errors-js]').html('Please enter a number value only...').css('color','red');
                //$('.newQty').val($(this).data('val'));
            } else if (inputValue % minOrderQty !== 0) {
                console.log('*** minOrderQty else if *** ' + minOrderQty);
                rerenderPanel1();
                $('[id$=errors-js]').html('Please enter a value that is a multiple of ' + minOrderQty + '...').css('color','white');
                //$('.newQty').val($(this).data('val'));
            } else {
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.PP_Price_Quote.updateQuantity}',
                    $(this).attr('data-id'),
                    inputValue,
                    function(result, event) {
                        console.log(result.Id + ' updated');
                        //priceQuotePanel();
                        rerenderPanel1();
                    }
                );
            }
        });

        
        //newQty handles logic for all other Sales Orgs (NOT EMEA)
        $('.newQty').on('focusin', function(){
            console.log('*** .newQty focus ***');
            //console.log("Saving value " + $(this).val());
            $(this).data('val', $(this).val());
        });

        var quoteName = "{!pq.Name}";
        var records;
        Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.PP_Price_Quote.getLiList}',
            quoteName,
            function(result, event){
                if(event.status){
                    records = result;
                }
            });

        //below if for updating quantities for non-tradeins    
        $('.newQty').change(function() {
            console.log('*** .newQty jquery ***');
            if($(this).val() == 0 || $(this).val() == 0.00 ){
                rerenderPanel1();
                //$('[id$=errors-js]').html('Please enter a value other than 0...').css('color','red');
                //$('.newQty').val($(this).data('val'));
            }
            else if($.isNumeric($(this).val()) === false ){
                rerenderPanel1();
                //$('[id$=errors-js]').html('Please enter a number value only...').css('color','red');
                //$('.newQty').val($(this).data('val'));
            }
            else{
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.PP_Price_Quote.updateQuantity}',
                    $(this).attr('data-id'),$(this).val(),
                    function(result, event){
                        console.log(result.Id + ' updated');
                        //priceQuotePanel();
                        rerenderPanel1();
                    });
            }
        });
        
        //below function is for updating quantities with tradein functionality
        /*
        - function below is triggered by changing quantity for any trade-in line item product for ANES/EMS/Alternate Care
        - switched code to the front-end to improve speed of functionality
        */
        $('.newQtyTrade').change(function() {
            console.log('*** .newQtyTrade jquery ***');
            if($(this).val() == 0 || $(this).val() == 0.00 ){
                rerenderPanel1();
                //$('[id$=errors-js]').html('Please enter a value other than 0...').css('color','red');
                //$('.newQty').val($(this).data('val'));
            }
            else if($.isNumeric($(this).val()) === false ){
                rerenderPanel1();
                //$('[id$=errors-js]').html('Please enter a number value only...').css('color','red');
                //$('.newQty').val($(this).data('val'));
            }
            else{
                //below code is used to handle trade-in functionality
                var bu = '{!pq.BusinessUnit__c}';
                var lineId = $(this).attr('data-id');
                var qty = $(this).val();
                console.log('*** $(this).attr(data-id) *** ' + $(this).attr('data-id'));
                console.log('*** records *** ' + records);
                //var tradeinNames = { "McGRATH MAC-Trade-in": "McGRATH MAC-Trade-in", "ARJ12001RU": "ARJ12001RU", "ARJ13302RU": "ARJ13302RU" };
                const tradeinNames = new Set();
                tradeinNames.add(['McGRATH MAC-Trade-in','ARJ12001RU','ARJ13302RU']);
                const tradeinIds = new Set();
                const tradeInMap = new Map();
                
                var arj1Qty = 0; //hold quantity for ARJ12001RU
                var arj2Qty = 0; //hold quantity for ARJ13302RU
                var mcgQty = 0; //hold quantity for McGRATH MAC-Trade-in
                //loop through records
                // Loop through the records using jQuery's $.each() function
                if(records){
                    console.log('***IN if(records)***');
                    $.each(records, function(index, record) {
                        // Process each record here
                        tradeinIds.add(record.Id)
                        tradeInMap.set(record.Id, record);
                        //console.log('*** tradeInMap ***' + tradeInMap);
                        //below checks are for each material involved in trade-in functionality
                        if(record.Material__c == 'ARJ12001RU' && record.Id == lineId){
                            console.log('***IN if(record.Material__c == ARJ12001RU && lineId***');
                            arj1Qty = parseInt(qty);
                        }else if(record.Material__c == 'ARJ12001RU'){
                            console.log('***IN else if(record.Material__c == ARJ12001RU***');
                        	arj1Qty = record.Quantity__c;
                        }
                        
                        if(record.Material__c == 'ARJ13302RU' && record.Id == lineId){
                            console.log('***IN if(record.Material__c == ARJ13302RU && lineId***');
                            arj2Qty = parseInt(qty);
                        }else if(record.Material__c == 'ARJ13302RU'){
                            console.log('***IN else if(record.Material__c == ARJ13302RU***');
                        	arj2Qty = record.Quantity__c;
                        }
                        
                        if(record.Material__c == 'McGRATH MAC-Trade-in' && record.Id == lineId){
                            console.log('***IN if(record.Material__c == McGRATH MAC-Trade-in && lineId***');
                            mcgQty = parseInt(qty);
                        }else if(record.Material__c == 'McGRATH MAC-Trade-in'){
                            console.log('***IN else if(record.Material__c == McGRATH MAC-Trade-in***');
                        	mcgQty = record.Quantity__c;
                        }
                            
                    });
                    
                    //check quantities
                    console.log('*** arj1Qty *** ' + arj1Qty);
                    console.log('*** arj2Qty *** ' + arj2Qty);
                    console.log('*** mcgQty *** ' + mcgQty);
                    console.log('*** (arj1Qty + arj2Qty) *** ' + (arj1Qty + arj2Qty) );
                    console.log('*** (arj1Qty + arj2Qty) >= mcgQty *** ' + (arj1Qty + arj2Qty) >= mcgQty );
                    //check if tradeinIds contains lineId being updated
                    if(tradeinIds.has(lineId)){
                        console.log('***IN if(tradeinIds.has(lineId))***');
                        //compare quantities to update
                        if( (arj1Qty + arj2Qty) >= mcgQty ){
                            console.log('***IN if( (arj1Qty + arj2Qty) >= mcgQty )***');
                            //do remote action
                            Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.PP_Price_Quote.updateQuantity}',
                                $(this).attr('data-id'),$(this).val(),
                                function(result, event){
                                    console.log(result.Id + ' updated');
                                    //priceQuotePanel();
                                    rerenderPanel1();
                                });
                        }else{
                            console.log('***IN else( (arj1Qty + arj2Qty) >= mcgQty )***');
                            //show error message
                            rerenderPanel1();
                            $('[id$=errors-js]').html('Only enter quanities equal or less than the trade-in quantity...').css('color','white');
                        }//end inner else
                    }else{
                        console.log('***IN if(tradeinIds.has(lineId)) PERFORMING REMOTEACTION***');
                        //do remote action
                        Visualforce.remoting.Manager.invokeAction(
                            '{!$RemoteAction.PP_Price_Quote.updateQuantity}',
                            $(this).attr('data-id'),$(this).val(),
                            function(result, event){
                                console.log(result.Id + ' updated');
                                //priceQuotePanel();
                                rerenderPanel1();
                            });                         
                    }//end else
                    //console.log('*** tradeInMap key ***' + tradeInMap['ARJ12001RU']);
                }
                //end loop
            }
        });

        //update pricing
        $('.newPrice').on('focusin', function(){
            console.log('*** .newPrice focus ***');
            console.log("Saving value " + $(this).val());
            $(this).data('val', $(this).val());
        });

        $('.newPrice').change(function() {
            console.log('*** .newPrice change ***');
            //userBu = '{!pq.Owner_Business_Unit__c}';
            //bUnit = 'Cardiac';
            //var role = '{!JSENCODE($UserRole.Name)}';
            //console.log('user role: ' + role);
            console.log("Checking value " + $(this).val());
            console.log("Checking data-id " + $(this).attr('data-id'));
            if( $.isNumeric($(this).val()) === false ){
                rerenderPanel1();
            }
            else{
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.PP_Price_Quote.updatePrice}',
                    $(this).attr('data-id'),$(this).val(),
                    function(result, event){
                        console.log(result.Id + ' updated');
                        //priceQuotePanel();
                        rerenderPanel1();
                    });
                //$('[id$=errors-js]').html('Please enter a number value only...').css('color','red');
                //$('.newPrice').val($(this).data('val'));
            }

        });

        //update pricing
        $('.blankInput').change(function() {
            console.log('*** .blankInput jquery ***');
          Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.PP_Price_Quote.updateBlank}',
            $(this).attr('data-id'),$(this).val(),
            function(result, event){
            console.log(result.Id + ' updated');
          });
        });

        $( "#sortable tbody" ).sortable({
            cursor: 'move',
            opacity: 0.60,
            tolerance: 'pointer',
            containment: 'parent',
            update: function(event, ui) {
                //$("#msg").toggle();
                var result = $(this).sortable('toArray');
                console.log('result ========== ' + result);
                length = result.length;
                var lineItem;
                for( i=0; i < length; i++){
                    lineItem = new sforce.SObject("Price_Quote_Line_Item__c");
                    lineItem.id = result[i];
                    lineItem.row_order__c = i+1;
                    console.log('lineItem.id ========== ' + lineItem.id + ', ' + lineItem.row_order__c);
                    //final = sforce.connection.update([lineItem]);
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.PP_Price_Quote.updateOrder}',
                        lineItem.id,lineItem.row_order__c,
                        function(result, event){
                            console.log(result.Id + ' updated');
                            //priceQuotePanel();
                            //rerenderPanel1();
                        });

                }
                //$("#msg").toggle();
            }
        });
        
        toggleTradeIn();

        //start of tradein mapping
        // Initialize the tradeinMatch map
        
        /*
        $('[name="piRemove"]').click(function() {
          console.log('*** Clicked Recall Button 1 ***');
            var pqId = '{!pq.Id}';
            console.log('*** pqId *** ' + pqId);
            if({!$User.UIThemeDisplayed == 'Theme4d'}){
                console.log('*** Clicked Recall Button 2 ***');
                Visualforce.remoting.Manager.invokeAction(
                  '{!$RemoteAction.PP_Price_Quote.recall}',
                  pqId,
                  function(result, event){
                  console.log('Recalled!!!');
                });
                console.log('Setting location!!!');
            }

        });
        */
    }//end of initialize
    //end function to update sales price and quantity

    //function to set BU for user for PRF Approval routing
    function selectBu(buValue){
        //console.log('buValue = ' + buValue + ' ***** userId = ' + userId);
        console.log('**** buValue = ' + buValue + ' *****');
        setBuValue(buValue);
        //$('[id$=errors-js]').empty();
    }

    function doReviseClone() {
        reviseClone();
    }

    //used to change account and contact
    function changeAccount() {
        $('.accountOutCtrls').css("display","none");
        $('.accountIntCtrls').css("display","block");

        $('.contactOutCtrls').css("display","none");
        $('.contactIntCtrls').css("display","block");

        //var obj = document.getElementById(updateId);
        //$(obj).css("display","");
        $('#update').css("display","inline-block");
    }

    //used to change owner
    function changeOwner() {
        $('.ownerOutCtrls').css("display","none");
        $('.ownerIntCtrls').css("display","block");

        $('#updateOwner').css("display","inline-block");
    }


    function oppChange(itemId){
        prodUpdate(itemId);
    }

    function processChange(itemId) {
        aSelectItem(itemId);
    }

    //function to handle bolding of line items
    function highlightBack(trId) {
        updateFlag(trId);
    }
    //end of function to handle bolding of line items

    function autoMaterialName(e, btnId) {
      console.log('*** In autoMaterialName... ENTER clicked ***');
      var btn = document.getElementById(btnId);
        e = e || window.event;
        if (e.keyCode == 13) {
            btn.disabled = true;
            btn.click();
        }
    }

    // Auto Scroll Script - http://jsfiddle.net/CbqFv/
    // From this post: http://stackoverflow.com/questions/454202/creating-a-textarea-with-auto-resize
    var observe;
    if (window.attachEvent) {
        observe = function (element, event, handler) {
            element.attachEvent('on'+event, handler);
        };
    }
    else {
        observe = function (element, event, handler) {
            element.addEventListener(event, handler, false);
        };
    }

    function init () {
        // Had to look at the source to get the nested id
        var text = document.getElementById('thePage:bulkform:autoresize');
        function resize () {
            text.style.height = 'auto';
            text.style.height = text.scrollHeight+'px';
        }
        /* 0-timeout to get the already changed text */
        function delayedResize () {
            window.setTimeout(resize, 0);
        }
        observe(text, 'change',  resize);
        observe(text, 'cut',     delayedResize);
        observe(text, 'paste',   delayedResize);
        observe(text, 'drop',    delayedResize);
        observe(text, 'keydown', delayedResize);

        //text.focus();
        //text.select();
        resize();
    }

    //init();
    // End Auto Scroll Script

    // Focus Script
    // https://developer.salesforce.com/forums/?id=906F000000099KSIAY
    var elementId = null;
    function setFocus(){
        elementId = document.activeElement.id;
    }
    function retainFocus(){
        document.getElementById(elementId).focus();
        document.getElementById(elementId).select();
    }
    
    /*
    Below implemented with Vascular Bundles functionality (See case #00031095)
    Hide/Show "Trade-In" button based on product "DLX-200-MTRB" being on the PQ
    */
    function toggleTradeIn(){
        var matNameVar = $("[id$=matName]").text();
        console.log('*** matNameVar *** ' + matNameVar);
        if(matNameVar.indexOf('DLX-200-MTRB') != -1 || matNameVar.indexOf('ARJ12001RU') != -1 || matNameVar.indexOf('ARJ13302RU') != -1){
            $('#tradein').show();
            $('#tradeinList').show();
        }
        else{
            $('#tradein').hide();
            $('#tradeinList').hide();
        }
    }//End toggleTradeIn
    
    //function to get lineitems
    /*
    function getLineItemDetails(quoteId) {
        Visualforce.remoting.execute(
        'PP_Price_Quote',
        'getLineItemDetails',
        {
            quoteId: quoteId,
        },
        function(result, event) {
            if (event.status) {
                const lineItemMap = result;
                // Use values from the map
                console.log('*** lineItemMap *** ' + lineItemMap);
                //$('#productName').text(productMap.Name);
                //$('#productPrice').text(productMap.Price);
            } else {
                alert('Error getting product details');
            }
        }
        );
    }
    */
    //end of function

    $(document).ready(function() {
        initialize();
        $("[id$=mlktp]").hide();  
    });//end document.ready
    </script>
</apex:page>